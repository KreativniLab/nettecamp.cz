"object"==typeof module&&"object"==typeof module.exports||(window.Nette={noInit:!0}),function(){global=this;var queueId=1,queue={},isRunningTask=!1;function nextTick(fn){global.setImmediate?setImmediate(fn):global.importScripts?setTimeout(fn):(queue[++queueId]=fn,global.postMessage(queueId,"*"))}function Deferred(resolver){"use strict";if("function"!=typeof resolver&&null!=resolver)throw TypeError();if("object"!=typeof this||this&&this.then)throw TypeError();var fn,er,self=this,state=0,val=0,next=[];(self.promise=self).resolve=function(v){return fn=self.fn,er=self.er,state||(val=v,state=1,nextTick(fire)),self},self.reject=function(v){return fn=self.fn,er=self.er,state||(val=v,state=2,nextTick(fire)),self},self._d=1,self.then=function(_fn,_er){if(1!=this._d)throw TypeError();var d=new Deferred;return d.fn=_fn,d.er=_er,3==state?d.resolve(val):4==state?d.reject(val):next.push(d),d},self.catch=function(_er){return self.then(null,_er)};var finish=function(type){state=type||4,next.map(function(p){3==state&&p.resolve(val)||p.reject(val)})};try{"function"==typeof resolver&&resolver(self.resolve,self.reject)}catch(e){self.reject(e)}return self;function thennable(ref,cb,ec,cn){if(2==state)return cn();if("object"!=typeof val&&"function"!=typeof val||"function"!=typeof ref)cn();else try{var cnt=0;ref.call(val,function(v){cnt++||(val=v,cb())},function(v){cnt++||(val=v,ec())})}catch(e){val=e,ec()}}function fire(){var ref;try{ref=val&&val.then}catch(e){return val=e,state=2,fire()}thennable(ref,function(){state=1,fire()},function(){state=2,fire()},function(){try{1==state&&"function"==typeof fn?val=fn(val):2==state&&"function"==typeof er&&(val=er(val),state=1)}catch(e){return val=e,finish()}val==self?(val=TypeError(),finish()):thennable(ref,function(){finish(3)},finish,function(){finish(1==state&&3)})})}}global.setImmediate||global.addEventListener("message",function(e){if(e.source==global)if(isRunningTask)nextTick(queue[e.data]);else{isRunningTask=!0;try{queue[e.data]()}catch(e){}delete queue[e.data],isRunningTask=!1}}),Deferred.resolve=function(value){if(1!=this._d)throw TypeError();return value instanceof Deferred?value:new Deferred(function(resolve){resolve(value)})},Deferred.reject=function(value){if(1!=this._d)throw TypeError();return new Deferred(function(resolve,reject){reject(value)})},Deferred.all=function(arr){if(1!=this._d)throw TypeError();if(!(arr instanceof Array))return Deferred.reject(TypeError());var d=new Deferred;return function done(e,v){return v?d.resolve(v):e?d.reject(e):(0==arr.reduce(function(cnt,v){return v&&v.then?cnt+1:cnt},0)&&d.resolve(arr),void arr.map(function(v,i){v&&v.then&&v.then(function(r){return arr[i]=r,done(),r},done)}))}(),d},Deferred.race=function(arr){if(1!=this._d)throw TypeError();if(!(arr instanceof Array))return Deferred.reject(TypeError());if(0==arr.length)return new Deferred;var d=new Deferred;return function done(e,v){return v?d.resolve(v):e?d.reject(e):(0==arr.reduce(function(cnt,v){return v&&v.then?cnt+1:cnt},0)&&d.resolve(arr),void arr.map(function(v,i){v&&v.then&&v.then(function(r){done(null,r)},done)}))}(),d},Deferred._d=1,"undefined"!=typeof module?module.exports=Deferred:global.Promise=global.Promise||Deferred}();var _context=function(){var api,undefined,t={},loaded=[],loading={},REQ_TIMEOUT=3e4,doc=document,elem=function(n){return doc.createElement(n)},win=window,loc=win.history.location||win.location,setTimeout=function(c,t){return win.setTimeout(c,t)},clearTimeout=function(t){return win.clearTimeout(t)},promise=Promise,resolver=null,nsStack=[],nonce=null,map={names:[],classes:[]};function resolveUrl(u){return resolver||(resolver=elem("a")),resolver.href=u,resolver.href}var xhrFactory=function(o,f){for(;o.length;)try{return(f=o.shift())(),f}catch(e){}return function(){throw new Error}}([function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}]),xdrFactory=function(){try{if("withCredentials"in new XMLHttpRequest)return function(){return new XMLHttpRequest};if(win.XDomainRequest!==undefined)return function(){return new win.XDomainRequest}}catch(err){}return function(){throw new Error}}();function xhr(u){return new promise(function(fulfill,reject){var req,m;(req=function(u){try{var len=/^https?:\/\/.+?(\/|$)/i.exec(loc.href)[0].length;return u.substr(0,len)===loc.href.substr(0,len)}catch(err){return!1}}(u)?xhrFactory():xdrFactory()).open("GET",u,!0);var f=function(){m&&clearTimeout(m),fulfill(req)},r=function(){m&&clearTimeout(m),reject(req)};"onsuccess"in req?(req.onsuccess=f,req.onerror=r):win.XDomainRequest!==undefined&&req instanceof win.XDomainRequest?(req.onload=f,req.onerror=r):req.onreadystatechange=function(){4===req.readyState&&(200===req.status?f():r())},req.send(),m=setTimeout(function(){if(req.readyState&&req.readyState<4)try{req.abort()}catch(err){}m=null,r()},REQ_TIMEOUT)})}function exec(s,t,u){var e,o=function(){if(null!==nonce)return nonce;var i,n,elem,elems=document.getElementsByTagName("script");for(i=0,n=elems.length;i<n;i++)if(elem=elems.item(i),/^((application|text)\/javascript)?$/i.test(elem.type)&&elem.nonce)return nonce=elem.nonce;return nonce=!1}();"text/css"===(t=t?t.replace(/\s*;.*$/,"").toLowerCase():u.match(/\.(?:less|css)/i)?"text/css":"application/javascript")?((e=elem("style")).type=t,o&&e.setAttribute("nonce",o),u=u.replace(/[^\/]+$/,""),s=s.replace(/url\s*\((['"])?(?:\.\/)?(.+?)\1\)/,function(m,q,n){return q||(q='"'),n.match(/^(?:(?:https?:)?\/)?\//)?"url("+q+n+q+")":"url("+q+resolveUrl(u+n)+q+")"}),e.styleSheet?e.styleSheet.cssText=s:e.appendChild(doc.createTextNode(s)),doc.head.appendChild(e)):((e=elem("script")).type=t,e.text=s,o&&e.setAttribute("nonce",o),doc.head.appendChild(e).parentNode.removeChild(e))}function lookup(s,c){var i=map.names.indexOf(s);if(-1<i)return map.classes[i];for(var n,r=t,p=s.split(".");p.length;){if(r[n=p.shift()]===undefined){if(!c)throw new Error(s+" not found in context");r[n]={}}r=r[n]}return map.names.push(s),map.classes.push(r),r}function invoke(ns,f,i){i===undefined&&"function"==typeof ns&&(i=f,f=ns,ns=null),ns?nsStack.unshift(ns,ns=lookup(ns,!0)):(ns=t,nsStack.unshift(null,ns));var p,c,r,params=f.length?f.toString().match(/^function\s*\((.*?)\)/i)[1].split(/\s*,\s*/):[],args=[];for(p=0;p<params.length;p++)if("context"===params[p])args.push(api);else if("_NS_"===params[p])args.push(ns);else if("undefined"===params[p])args.push(undefined);else if(i!==undefined&&params[p]in i)"string"==typeof(c=i[params[p]])&&(c=lookup(c)),args.push(c);else if(ns[params[p]]!==undefined)args.push(ns[params[p]]);else{if(t[params[p]]===undefined)throw new Error('"'+params[p]+'" not found in context');args.push(t[params[p]])}return r=f.apply(ns,args),nsStack.shift(),nsStack.shift(),r}function copyProps(target,source,map){var key;for(key in source)source.hasOwnProperty(key)&&"STATIC"!==key&&(target[map&&key in map?map[key]:key]=source[key])}return api={lookup:lookup,lookupClass:function(o){if("object"==typeof o&&o.constructor!==Object&&(o=o.constructor),"function"!=typeof o&&"object"!=typeof o)throw new Error("Cannot lookup class name of non-object");var i=map.classes.indexOf(o);return-1!==i&&map.names[i]},invoke:invoke,load:function(){var u,a,p=promise.resolve(!0);for(a=0;a<arguments.length;a++)"function"==typeof arguments[a]?p=p.then(function(f){return function(){return invoke(f)}}(arguments[a])):"string"==typeof arguments[a]&&(u=resolveUrl(arguments[a]),-1===loaded.indexOf(u)&&(p=loading[u]?p.then(function(p){return function(){return p}}(loading[u])):loading[u]=function(p,u){return new promise(function(f,r){xhr(u).then(function(xhr){p.then(function(){exec(xhr.responseText,xhr.getResponseHeader("Content-Type"),u),delete loading[u],loaded.push(u),f()},r)})})}(p,u)));return a={then:function(fulfilled,rejected){return p.then(function(){fulfilled&&invoke(fulfilled)},function(){rejected&&invoke(rejected)}),a}}},extend:function(parent,constructor,proto){proto||(proto=constructor,constructor=parent,parent=null),parent?"string"==typeof parent&&(parent=lookup(parent)):parent=Object;var tmp=function(){};return tmp.prototype=parent.prototype,constructor.prototype=new tmp,(constructor.prototype.constructor=constructor).Super=parent,proto&&(proto.hasOwnProperty("STATIC")&&proto.STATIC&&copyProps(constructor,proto.STATIC),copyProps(constructor.prototype,proto)),constructor},mixin:function(target,source,map){return"string"==typeof target&&(target=lookup(target)),"string"==typeof source&&(source=lookup(source)),source.hasOwnProperty("STATIC")&&source.STATIC&&function merge(a,b){for(var key in b)b.hasOwnProperty(key)&&(a.hasOwnProperty(key)&&"object"==typeof a[key]&&"object"==typeof b[key]&&a[key]?b[key]&&merge(a[key],b[key]):a[key]=b[key])}(target,source.STATIC),copyProps(target.prototype,source,map),target},register:function(constructor,name){var ns=name.split(/\./g),key=ns.pop();return(ns=ns.length?lookup(ns.join("."),!0):nsStack.length&&null!==nsStack[0]?(name=nsStack[0]+"."+name,nsStack[1]):t)[key]=constructor,map.names.push(name),map.classes.push(constructor),api},__ns:function(){arguments.length?nsStack.unshift(arguments[0],arguments[1]):(nsStack.shift(),nsStack.shift())}}}();_context.invoke("Utils",function(undefined){var Strings={applyModifiers:function(s){for(var a,m,f=Array.prototype.slice.call(arguments,1),i=0;i<f.length;i++)m=(a=f[i].split(":")).shift(),a.unshift(s),s=Strings[m].apply(Strings,a);return s},toString:function(s){return s===undefined?"undefined":"string"==typeof s?s:s.toString!==undefined?s.toString():Object.prototype.toString.call(s)},sprintf:function(s){return Strings.vsprintf(s,Array.prototype.slice.call(arguments,1))},vsprintf:function(s,args){var n=0;return s.replace(/%(?:(\d+)\$)?(\.\d+|\[.*?:.*?\])?([idsfa%])/g,function(m,a,p,f){if("%"===f)return f;if(a=a?parseInt(a)-1:n++,args[a]===undefined)throw new Error("Missing parameter #"+(a+1));switch(a=args[a],f){case"s":return Strings.toString(a);case"i":case"d":return parseInt(a);case"f":return a=parseFloat(a),p&&p.match(/^\.\d+$/)&&(a=a.toFixed(parseInt(p.substr(1)))),a;case"a":return p=p&&p.match(/^\[.*:.*\]$/)?p.substr(1,p.length-2).split(":"):[", ",", "],0===a.length?"":a.slice(0,-1).join(p[0])+(1<a.length?p[1]:"")+a[a.length-1]}return m})},webalize:function(s,chars,ws){return ws&&(s=s.replace(/\s+/g,"_")),s=s.replace(new RegExp("[^_A-Za-zÀ-ſ"+Strings.escapeRegex(chars||"").replace(/\\-/g,"-")+"]+","g"),"-"),Strings.trim(s,"_-")},escapeRegex:function(s){return s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},split:function(s,re,offsetCapture,noEmpty,delimCapture){re=re instanceof RegExp?new RegExp(re.source,[re.ignoreCase?"i":"",re.multiline?"m":"","g"].filter(function(v){return!!v}).join("")):new RegExp(re,"g");var r=[],len=0;return s=s.replace(re,function(m,p,ofs){return ofs=arguments[arguments.length-2],((p=s.substring(len,ofs)).length&&!p.match(/^[\t ]+$/)||!noEmpty)&&r.push(offsetCapture?[p,len]:s.substring(len,ofs)),delimCapture&&(m.length&&!m.match(/^[\t ]+$/)||!noEmpty)&&r.push(offsetCapture?[m,ofs]:m),len=ofs+m.length,m}),(len<s.length||!noEmpty)&&(s=s.substring(len),(!noEmpty||s.length&&!s.match(/^[\t ]+$/))&&r.push(offsetCapture?[s,len]:s)),r},trim:function(s,c){return Strings._trim(s,c,!0,!0)},trimLeft:function(s,c){return Strings._trim(s,c,!0,!1)},trimRight:function(s,c){return Strings._trim(s,c,!1,!0)},_trim:function(s,c,l,r){c||(c=" \t\n\r\0\vÂ ");var re=[];return c="["+Strings.escapeRegex(c)+"]+",l&&re.push("^",c),l&&r&&re.push("|"),r&&re.push(c,"$"),s.replace(new RegExp(re.join(""),"ig"),"")},firstUpper:function(s){return s.substr(0,1).toUpperCase()+s.substr(1)},compare:function(a,b,len){return"string"==typeof a&&"string"==typeof b&&(len||(len=Math.min(a.length,b.length)),a.substr(0,len).toLowerCase()===b.substr(0,len).toLowerCase())},contains:function(h,n){return-1!==h.indexOf(n)},isNumeric:function(s){return"[object Array]"!==Object.prototype.toString.call(s)&&0<=s-parseFloat(s)+1},escapeHtml:function(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},nl2br:function(s,collapse){return s.replace(collapse?/\n+/g:/\n/g,"<br />")},random:function(len,chars){chars=(chars||"a-z0-9").replace(/.-./g,function(m,a,b){a=m.charCodeAt(0),b=m.charCodeAt(2);for(var n=Math.abs(b-a),c=new Array(n),o=Math.min(a,b),i=0;i<=n;i++)c[i]=o+i;return String.fromCharCode.apply(null,c)}),len||(len=8);var i,s=new Array(len),n=chars.length-1;for(i=0;i<len;i++)s[i]=chars[Math.round(Math.random()*n)];return s.join("")}};_context.register(Strings,"Strings")}),_context.invoke("Utils",function(undefined){var Arrays={isArrayLike:function(a){return"object"==typeof a&&a.length!==undefined},shuffle:function(a){for(var t,i,c=a.length;c--;)i=Math.random()*c|0,t=a[c],a[c]=a[i],a[i]=t;return a},createFrom:function(a,s,e){if(a.length===undefined)throw new Error("Invalid argument, only array-like objects can be supplied");return Array.prototype.slice.call(a,s||0,e||a.length)},getKeys:function(a){var k,keys=[];if(Array.isArray(a))for(k=0;k<a.length;k++)keys.push(k);else for(k in a)keys.push(k);return keys},filterKeys:function(){var a,i,rem,args=Arrays.createFrom(arguments),t=args.shift(),r={};for(rem=function(k){r[k]===undefined&&(r[k]=t[k],delete t[k])};args.length;)if("object"==typeof(a=args.shift()))if(a instanceof Array)for(i=0;i<a.length;i++)rem(a[i]);else for(i in a)rem(i);else rem(a)},getValues:function(a){var k,arr=[];for(k in a)arr.push(a[k]);return arr},merge:function(){var b,i,args=Arrays.createFrom(arguments),a=args.shift(),r=!1;for("boolean"==typeof a&&(r=a,a=args.shift()),a||(a=[]);args.length;)if((b=args.shift())instanceof Array)for(i=0;i<b.length;i++)r&&"object"==typeof b[i]&&"[object Object]"===Object.prototype.toString.call(b[i])?a.push(Arrays.mergeTree(r,{},b[i])):a.push(b[i]);return a},mergeTree:function(){var r=!1,args=Arrays.createFrom(arguments),ofs=1,t=args.shift(),props=[];for("boolean"==typeof t&&(r=t,t=args.shift(),ofs=2);args.length;){var p,a,i,o=args.pop();if("object"==typeof o&&null!==o)for(p in t||(t={}),o)if(o.hasOwnProperty(p)&&-1===props.indexOf(p)){if("object"==typeof o[p])if(r)if(o[p]instanceof Array){for(a=[r,t[p]||null],i=ofs;i<arguments.length;i++)a.push(arguments[i][p]||null);t[p]=Arrays.merge.apply(this,a)}else{for(a=[r,null],i=ofs;i<arguments.length;i++)a.push(arguments[i]&&arguments[i][p]||null);t[p]=Arrays.mergeTree.apply(this,a)||t[p]}else t[p]=t[p]===undefined?o[p]:null===o[p]?t[p]:o[p];else t[p]=o[p];props.push(p)}}return t},walk:function(r,a,f){"boolean"!=typeof r&&(f=a,a=r,r=!1);var i,p=function(k,v){r&&(v instanceof Array||v instanceof Object)?Arrays.walk(r,v,f):f.call(v,k,v)};if(a instanceof Array)for(i=0;i<a.length;i++)p(i,a[i]);else if(a instanceof Object)for(i in a)p(i,a[i]);else p(null,a)}};_context.register(Arrays,"Arrays")}),_context.invoke("Utils",function(Arrays,undefined){var HashMap=_context.extend(function(src){this._={keys:[],values:[],nonNumeric:0,nextNumeric:0},src&&this.merge(src)},{STATIC:{from:function(data,keys){if(!keys)return data instanceof HashMap?data.clone():new HashMap(data);if(!Array.isArray(keys))throw new Error("Invalid argument supplied to HashMap.from(): the second argument must be an array");var i,k,map=new HashMap,n=keys.length,arr=Array.isArray(data);for(i=0;i<n;i++)data[k=arr?i:keys[i]]!==undefined&&map.set(keys[i],data[k]);return map}},length:0,isList:function(){return 0===this._.nonNumeric},clone:function(deep){var o=new HashMap;return o._.keys=this._.keys.slice(),o._.nextNumeric=this._.nextNumeric,o.length=this.length,o._.values=deep?this._.values.map(function(v){return v instanceof HashMap?v.clone(deep):v}):this._.values.slice(),o},merge:function(src){if(src instanceof HashMap||Array.isArray(src))src.forEach(function(value,key){this.set(key,value)},this);else{if("object"!=typeof src||null===src)throw new TypeError("HashMap.merge() expects the first argument to be an array or an object, "+typeof src+" given");for(var k in src)src.hasOwnProperty(k)&&this.set(k,src[k])}return this},append:function(src){return src instanceof HashMap||Array.isArray(src)?src.forEach(function(value,key){"number"==typeof key?this.push(value):this.set(key,value)},this):this.merge(src),this},push:function(value){for(var i=0;i<arguments.length;i++)this._.keys.push(this._.nextNumeric),this._.values.push(arguments[i]),this._.nextNumeric++,this.length++;return this},pop:function(){if(!this.length)return null;var k=this._.keys.pop();return"number"==typeof k?k+1===this._.nextNumeric&&this._.nextNumeric--:this._.nonNumeric--,this.length--,this._.values.pop()},shift:function(){return this.length?("number"==typeof this._.keys[0]?(this._.nextNumeric--,this._shiftKeys(1,this.length,-1)):this._.nonNumeric--,this.length--,this._.keys.shift(),this._.values.shift()):null},unshift:function(value){for(var values=Arrays.createFrom(arguments),n=values.length,i=0,keys=new Array(n);i<n;)keys[i]=i++;return keys.unshift(0,0),values.unshift(0,0),this._shiftKeys(0,this.length,n),this._.keys.splice.apply(this._.keys,keys),this._.values.splice.apply(this._.values,values),this._.nextNumeric+=n,this.length+=n,this},slice:function(from,to){from===undefined&&(from=0),from<0&&(from+=this.length),to===undefined&&(to=this.length),to<0&&(to+=this.length);var o=new HashMap;return o._.keys=this._.keys.slice(from,to).map(function(k){return"number"==typeof k?(k=o._.nextNumeric,o._.nextNumeric++):o._.nonNumeric++,k}),o._.values=this._.values.slice(from,to),o.length=o._.keys.length,o},splice:function(from,remove){var removed,i,values=Arrays.createFrom(arguments),keys=values.slice().map(function(){return-1});for(keys[0]=values[0],keys[1]=values[1],this._.keys.splice.apply(this._.keys,keys),removed=this._.values.splice.apply(this._.values,values),this.length=this._.keys.length,this._.nextNumeric=0,i=this._.nonNumeric=0;i<this.length;i++)"number"==typeof this._.keys[i]?(this._.keys[i]=this._.nextNumeric,this._.nextNumeric++):this._.nonNumeric++;return removed},set:function(key,value){var i=this._.keys.indexOf(key);return-1===i?(this._.keys.push(key),this._.values.push(value),this.length++,"number"==typeof key?key>=this._.nextNumeric&&(this._.nextNumeric=key+1):this._.nonNumeric++):this._.values[i]=value,this},get:function(key,need){var i=this._.keys.indexOf(key);if(-1<i)return this._.values[i];if(need)throw new RangeError("Key "+key+" not present in HashMap");return null},has:function(key){var index=this._.keys.indexOf(key);return-1<index&&this._.values[index]!==undefined},remove:function(key,strict){var index=this._.keys.indexOf(key);if(-1<index)this._.keys.splice(index,1),this._.values.slice(index,1),this.length--,"number"==typeof key?key+1===this._.nextNumeric&&this._.nextNumeric--:this._.nonNumeric--;else if(strict)throw new RangeError("Key "+key+" not present in HashMap");return this},forEach:function(callback,thisArg){for(var i=0;i<this.length;i++)callback.call(thisArg||null,this._.values[i],this._.keys[i],this);return this},map:function(callback,recursive,thisArg){return this.clone(recursive).walk(callback,recursive,thisArg)},walk:function(callback,recursive,thisArg){for(var i=0;i<this.length;i++)recursive&&this._.values[i]instanceof HashMap?this._.values[i].walk(callback,recursive,thisArg):this._.values[i]=callback.call(thisArg||null,this._.values[i],this._.keys[i],this);return this},find:function(predicate,thisArg){var i=this._find(predicate,thisArg,!0);return!1===i?null:this._.values[i]},findKey:function(predicate,thisArg){var i=this._find(predicate,thisArg,!0);return!1===i?null:this._.keys[i]},some:function(predicate,thisArg){return!1!==this._find(predicate,thisArg,!0)},all:function(predicate,thisArg){return!1===this._find(predicate,thisArg,!1)},filter:function(predicate,thisArg){var i,o=new HashMap;for(i=0;i<this.length;i++)predicate.call(thisArg||null,this._.values[i],this._.keys[i],this)&&("number"==typeof this._.keys[i]?o.push(this._.values[i]):o.set(this._.keys[i],this._.values[i]));return o},exportData:function(){if(this.isList())return this.getValues().map(function(v){return v instanceof HashMap?v.exportData():v});for(var i=0,r={};i<this.length;i++)this._.values[i]instanceof HashMap?r[this._.keys[i]]=this._.values[i].exportData():r[this._.keys[i]]=this._.values[i];return r},getKeys:function(){return this._.keys.slice()},getValues:function(){return this._.values.slice()},_shiftKeys:function(from,to,diff){for(;from<to;)"number"==typeof this._.keys[from]&&(this._.keys[from]+=diff),from++},_find:function(predicate,thisArg,expect){for(var i=0;i<this.length;i++)if(predicate.call(thisArg||null,this._.values[i],this._.keys[i],this)===expect)return i;return!1}});_context.register(HashMap,"HashMap")}),_context.invoke("Utils",function(Strings,undefined){var location=window.history.location||window.location,Url=function(s){if(null===s||""===s||s===undefined)this._={protocol:location.protocol,hostname:location.hostname,port:location.port,path:location.pathname,params:Url.parseQuery(location.search),hash:location.hash},url=location.href,onto=this._,-1<(tmp=(url=url.replace(Url.RE_PROTOCOL,"")).indexOf("@"))?(tmp=url.substr(0,tmp).split(":",2),onto.username=tmp[0],onto.password=tmp[1]||""):onto.username=onto.password="";else{s+="";var auth,i,proto=Url.RE_PROTOCOL.exec(s);if(this._={protocol:proto&&proto[1]||location.protocol},proto){if(!(proto[2]&&proto[3]||proto[4]))return this._.username=this._.password=this._.hostname=this._.port=this._.path=this._.hash="",void(this._.params={});s=s.substr(proto[0].length),auth=Url.RE_AUTHORITY.exec(s)||[""],s=s.substr(auth[0].length),this._.username=auth[1]||"",this._.password=auth[2]||"",this._.hostname=auth[3]||"",this._.port=auth[4]||""}else this._.username="",this._.password="",this._.hostname=location.hostname,this._.port=location.port;-1<(i=s.indexOf("#"))?(this._.hash=s.substr(i),s=s.substr(0,i)):this._.hash="",-1<(i=s.indexOf("?"))?(this._.params=Url.parseQuery(s.substr(i+1)),s=s.substr(0,i)):this._.params={},this._.path=s||"/"}var url,onto,tmp};Url.prototype.getProtocol=function(){return this._.protocol},Url.prototype.getUsername=function(){return this._.username},Url.prototype.getPassword=function(){return this._.password},Url.prototype.getHostname=function(){return this._.hostname},Url.prototype.getPort=function(){return this._.port},Url.prototype.getAuthority=function(){var a="";return this._.username&&(this._.password?a+=this._.username+":"+this._.password+"@":a+=this._.username+"@"),a+=this._.hostname,this._.port&&(a+=":"+this._.port),a},Url.prototype.getOrigin=function(){return this._.protocol+"//"+this._.hostname+(this._.port?":"+this._.port:"")},Url.prototype.getPath=function(){return this._.path},Url.prototype.getQuery=function(){var q=Url.buildQuery(this._.params);return q.length?"?"+q:""},Url.prototype.getParam=function(n){return this._.params[n]},Url.prototype.hasParam=function(n){return this._.params[n]!==undefined},Url.prototype.getParams=function(){return this._.params},Url.prototype.getHash=function(){return this._.hash},Url.prototype.setProtocol=function(protocol){return this._.protocol=protocol?Strings.trimRight(protocol,":")+":":"",this},Url.prototype.setUsername=function(username){return this._.username=username,this},Url.prototype.setPassword=function(password){return this._.password=password,this},Url.prototype.setHostname=function(hostname){return this._.hostname=hostname,this},Url.prototype.setPort=function(port){return this._.port=port,this},Url.prototype.setPath=function(path){return this._.path=path?"/"+Strings.trimLeft(path,"/"):"",this},Url.prototype.setQuery=function(query){return this._.params=Url.parseQuery(query),this},Url.prototype.setParam=function(n,v){return this._.params[n]=v,this},Url.prototype.addParams=function(p){for(var k in Array.isArray(p)&&p.length&&"name"in p[0]&&"value"in p[0]&&(p=Url.parseQuery(Url.buildQuery(p,!0))),p)p[k]!==undefined&&(this._.params[k]=p[k]);return this},Url.prototype.getParams=function(){return this._.params},Url.prototype.setParams=function(p){return this._.params={},this.addParams(p),this},Url.prototype.removeParam=function(n){return delete this._.params[n],this},Url.prototype.setHash=function(hash){return this._.hash=hash?"#"+Strings.trimLeft(hash,"#"):"",this},Url.prototype.toAbsolute=function(){return this._.protocol+"//"+this.getAuthority()+this._.path+this.getQuery()+this._.hash},Url.prototype.toLocal=function(){return this._.path+this.getQuery()+this._.hash},Url.prototype.toRelative=function(to){if((to=Url.from(to||location.href)).getProtocol()!==this.getProtocol())return this.toAbsolute();if(to.getAuthority()!==this.getAuthority())return"//"+this.getAuthority()+this.getPath()+this.getQuery()+this.getHash();if(to.getPath()!==this.getPath())return Url.getRelativePath(to.getPath(),this.getPath())+this.getQuery()+this.getHash();var qto=to.getQuery(),qthis=this.getQuery();return qto!==qthis?qthis+this.getHash():to.getHash()===this.getHash()?"":this.getHash()},Url.prototype.toString=function(){return this.toAbsolute()},Url.prototype.isLocal=function(){return this.compare(Url.fromCurrent())<Url.PART.PORT},Url.prototype.compare=function(to){to instanceof Url||(to=Url.from(to));var r=0;return this.getProtocol()!==to.getProtocol()&&(r|=Url.PART.PROTOCOL),this.getUsername()!==to.getUsername()&&(r|=Url.PART.USERNAME),this.getPassword()!==to.getPassword()&&(r|=Url.PART.PASSWORD),this.getHostname()!==to.getHostname()&&(r|=Url.PART.HOSTNAME),this.getPort()!==to.getPort()&&(r|=Url.PART.PORT),this.getPath()!==to.getPath()&&(r|=Url.PART.PATH),this.getQuery()!==to.getQuery()&&(r|=Url.PART.QUERY),this.getHash()!==to.getHash()&&(r|=Url.PART.HASH),r},Url.RE_PROTOCOL=/^((?:(https?)|[a-z][a-z0-9.+-]*):)(\/\/)?|^(\/\/)/i,Url.RE_AUTHORITY=/^(?:([^@:]+?)(?::([^@]+))?@)?([^:\/]+)(?::(\d+))?/,Url.PART={PROTOCOL:128,USERNAME:64,PASSWORD:32,HOSTNAME:16,PORT:8,PATH:4,QUERY:2,HASH:1},Url.from=function(s){return new Url(s instanceof Url?s.toAbsolute():s)},Url.fromCurrent=function(){return new Url},Url.getDirName=function(path){return path.replace(/(^|\/)[^\/]*$/,"")},Url.getRelativePath=function(from,to){if((from=Strings.trimLeft(from,"/").split("/")).pop(),!to.match(/^\//))return to.replace(/^\.\//,"");to=Strings.trimLeft(to,"/").split("/");for(var f,t,e=0,o=[],n=Math.min(from.length,to.length);e<n&&from[e]===to[e];e++);for(f=e;f<from.length;f++)o.push("..");for(t=e;t<to.length;t++)o.push(to[t]);return o.join("/")},Url.buildQuery=function(data,pairs){var n,q=[];function en(v){return encodeURIComponent(v).replace(/%20/g,"+")}function val(v){return v===undefined?null:"boolean"==typeof v?v?1:0:en(""+v)}function flatten(a,n){var i,r=[];if(Array.isArray(a))for(i=0;i<a.length;i++)r.push(en(n+"[]")+"="+val(a[i]));else for(i in a)"object"==typeof a[i]?r.push(flatten(a[i],n+"["+i+"]")):r.push(en(n+"["+i+"]")+"="+val(a[i]));return r.length?r.filter(function(v){return null!==v}).join("&"):null}for(n in data)null!==data[n]&&data[n]!==undefined&&(pairs?q.push(en(data[n].name)+"="+val(data[n].value)):"object"==typeof data[n]?q.push(flatten(data[n],n)):q.push(en(n)+"="+val(data[n])));return q.filter(function(v){return null!==v}).join("&")},Url.parseQuery=function(s){if(s.match(/^\??$/))return{};s=Strings.trimLeft(s,"?").split("&");var c,d,k,i,m,n,v,p={},a=!1;function dec(v){return decodeURIComponent(v.replace(/\+/g," "))}function convertType(v){var c;return v.match(/^(?:[1-9]\d*|0)$/)&&(c=parseInt(v))+""===v?c:v.match(/^\d*\.\d+$/)&&(c=parseFloat(v))+""===v?c:v}for(i=0;i<s.length;i++)if(n=dec((m=s[i].split("=")).shift()),v=convertType(dec(m.join("="))),-1!==n.indexOf("[")){for(d=(n=n.replace(/\]/g,"")).split("["),c=p,a=!1,n.match(/\[$/)&&(d.pop(),a=!0),n=d.pop();d.length;)c[k=d.shift()]===undefined&&(c[k]={}),c=c[k];a?c[n]===undefined?c[n]=[v]:c[n].push(v):c[n]=v}else p[n]=v;return p},_context.register(Url,"Url")}),_context.invoke("Utils",function(Arrays,Strings,undefined){function map(args,callback){if(args=Arrays.createFrom(args),Array.isArray(args[0])){for(var i=0,elems=args[0],ret=[];i<elems.length;i++)args[0]=getElem(elems[i]),args[0]?ret.push(callback.apply(null,args)):ret.push(args[0]);return ret}return args[0]=getElem(args[0]),args[0]?callback.apply(null,args):args[0]}function getElem(elem){return(Array.isArray(elem)||elem instanceof HTMLCollection||elem instanceof NodeList)&&(elem=elem[0]),"string"==typeof elem?DOM.getById(elem):elem}function getPrefixed(elem,prop){if(!(elem=getElem(elem))||prop in elem.style)return prop;var i,p=prop.charAt(0).toUpperCase()+prop.substr(1),variants=["webkit"+p,"moz"+p,"o"+p,"ms"+p];for(i=0;i<variants.length;i++)if(variants[i]in elem.style)return variants[i];return prop}"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(event,params){params=params||{bubbles:!1,cancelable:!1,detail:undefined};var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt},window.CustomEvent.prototype=window.Event.prototype);var knownEventModules={MouseEvent:{create:function(type,params){return params.view||(params.view=window),new MouseEvent(type,params)},init:function(event,type,params){event.initMouseEvent(type,params.bubbles,params.cancelable,params.view||window,params.detail||1,params.screenX||0,params.screenY||0,params.clientX||0,params.clientY||0,params.ctrlKey||!1,params.altKey||!1,params.shiftKey||!1,params.metaKey||!1,params.button||1,params.relatedTarget)}},KeyboardEvent:{create:function(type,params){return new KeyboardEvent(type,params)},init:function(event,type,params){var modifiers=[];params.ctrlKey&&modifiers.push("Control"),params.shiftKey&&modifiers.push("Shift"),params.altKey&&modifiers.push("Alt"),params.metaKey&&modifiers.push("Meta"),event.initKeyboardEvent(type,params.bubbles,params.cancelable,params.view||window,params.key||"",params.location||0,modifiers.join(" "))}},FocusEvent:{create:function(type,params){return new FocusEvent(type,params)},init:function(event,type,params){event.initUIEvent(type,params.bubbles,params.cancelable,params.view||window,params.detail||0)},name:"UIEvent"},HTMLEvents:{create:function(type,params){return new Event(type,params)},init:function(event,type,params){event.initEvent(type,params.bubbles,params.cancelable)}},CustomEvent:{create:function(type,params){return new CustomEvent(type,params)},init:function(event,type,params){event.initCustomEvent(type,params.bubbles,params.cancelable,params.detail)}}},knownEvents={click:"MouseEvent",dblclick:"MouseEvent",mousedown:"MouseEvent",mouseenter:"MouseEvent",mouseleave:"MouseEvent",mousemove:"MouseEvent",mouseout:"MouseEvent",mouseover:"MouseEvent",mouseup:"MouseEvent",contextmenu:"MouseEvent",keydown:"KeyboardEvent",keypress:"KeyboardEvent",keyup:"KeyboardEvent",focus:"FocusEvent",blur:"FocusEvent",change:"HTMLEvents",submit:"HTMLEvents",reset:"HTMLEvents"},containers={caption:"table",colgroup:"table",col:"colgroup",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",li:"ul",optgroup:"select",option:"select"},DOM={getByClassName:function(className,context){return Arrays.createFrom((context||document).getElementsByClassName(className))},getById:function(id){return document.getElementById(id)},find:function(sel,context){var elems=[];return(sel=sel.trim().split(/\s*,\s*/g)).forEach(function(s){var m=s.match(/^#([^\s\[>+:.]+)\s+\.([^\s\[>+:]+)$/);if(m)elems.push.apply(elems,DOM.getByClassName(m[2],DOM.getById(m[1])));else{if(s.match(/^[^.#]|[\s\[>+:]/))throw new TypeError('Invalid selector "'+s+'", only single-level .class and #id or "#id .class" are allowed');"#"===s.charAt(0)?(m=DOM.getById(s.substr(1)))&&elems.push(m):(m=DOM.getByClassName(s.substr(1),context),elems.push.apply(elems,m))}}),elems},getChildren:function(elem){return Arrays.createFrom(elem.childNodes||"").filter(function(node){return 1===node.nodeType})},closest:function(elem,nodeName,className){return map(arguments,function(elem,nodeName,className){for(;elem;){if(1===elem.nodeType&&(!nodeName||elem.nodeName.toLowerCase()===nodeName)&&(!className||DOM.hasClass(elem,className)))return elem;elem=elem.parentNode}return null})},create:function(elem,attrs){return elem=document.createElement(elem),attrs&&DOM.setAttributes(elem,attrs),elem},createFromHtml:function(html){var container,elems;return(container=html.match(/^\s*<(caption|colgroup|col|thead|tbody|tfoot|tr|th|td|li|optgroup|option)[\s>]/i))&&(container=containers[container[1].toLowerCase()]),container=DOM.create(container||"div"),DOM.html(container,html),(elems=DOM.getChildren(container)).forEach(function(e){container.removeChild(e)}),container=null,1<elems.length?elems:elems[0]},setAttributes:function(elem,attrs){return map([elem],function(elem){for(var a in attrs)attrs.hasOwnProperty(a)&&elem.setAttribute(a,attrs[a]);return elem})},setStyle:function(elem,prop,value,prefix){if(prop&&"object"==typeof prop){for(prop in prefix=value,value=prop)value.hasOwnProperty(prop)&&DOM.setStyle(elem,prop,value[prop],prefix);return elem}return!1!==prefix&&(prop=getPrefixed(elem,prop)),map([elem],function(elem){elem.style[prop]=value})},getStyle:function(elem,props,prefix){Array.isArray(props)||(props=props.split(/\s+/g));var prefixed=props;return!1!==prefix&&(prefixed=props.map(function(prop){return getPrefixed(elem,prop)})),map([elem],function(elem){var style=window.getComputedStyle(elem);if(1===props.length)return style[prefixed[0]];var res={};return props.forEach(function(prop,i){res[prop]=style[prefixed[i]]}),res})},getStyleFloat:function(elem,props,prefix){Array.isArray(props)||(props=props.split(/\s+/g));var style=DOM.getStyle(elem,props,prefix),refloat=/^(\d+|\d*\.\d+)(px|m?s)?$/;function normalizeValue(v){var m=refloat.exec(v);return m&&(v=parseFloat(m[1]),"s"===m[2]&&(v*=1e3)),v}function stylePropsToFloat(style){return 1===props.length?normalizeValue(style):(props.forEach(function(prop){style[prop]=normalizeValue(style[prop])}),style)}return Array.isArray(style)?style.map(stylePropsToFloat):stylePropsToFloat(style)},html:function(elem,html){return map([elem],function(elem){elem.innerHTML=html,Arrays.createFrom(elem.getElementsByTagName("script")).forEach(function(elem){var type=elem.type?elem.type.toLowerCase():null;if(!type||"text/javascript"===type||"application/javascript"===type){var i,script,load=elem.hasAttribute("src"),src=load?elem.src:elem.text||elem.textContent||elem.innerHTML||"",attrs={};for(i=0;i<elem.attributes.length;i++)"src"!==elem.attributes.item(i).name&&(attrs[elem.attributes.item(i).name]=elem.attributes.item(i).value);if(script=DOM.create("script",attrs),load)script.src=src;else try{script.appendChild(document.createTextNode(src))}catch(e){script.text=src}elem.parentNode.insertBefore(script,elem),elem.parentNode.removeChild(elem)}})})},text:function(str){return 1<arguments.length&&(str=Array.isArray(arguments[1])?Strings.vsprintf(str,arguments[1]):Arrays.createFrom(arguments).join(" ")),document.createTextNode(str)},empty:function(elem){return map(arguments,function(elem){for(;elem.firstChild;)elem.removeChild(elem.firstChild)})},append:function(elem,children){return elem=getElem(elem),(children=Array.isArray(children)?children:Arrays.createFrom(arguments,1)).forEach(function(child){elem.appendChild(child)}),elem},prepend:function(elem,children){elem=getElem(elem),children=Array.isArray(children)?children:Arrays.createFrom(arguments,1);var first=elem.firstChild;return children.forEach(function(child){elem.insertBefore(child,first)}),elem},insertBefore:function(before,elem){var parent,elems=Array.isArray(elem)?elem:Arrays.createFrom(arguments,1);return before=getElem(before),parent=before.parentNode,elems.forEach(function(elem){parent.insertBefore(elem,before)}),before},contains:function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))},addListener:function(elem,evt,listener,capture){return map(arguments,function(elem,evt,listener,capture){return elem.addEventListener(evt,listener,!!capture),elem})},removeListener:function(elem,evt,listener,capture){return map(arguments,function(elem,evt,listener,capture){return elem.removeEventListener(evt,listener,!!capture),elem})},trigger:function(elem,evt,params){if(elem=getElem(elem)){var event,module=knownEvents[evt]||"CustomEvent";params||(params={}),"bubbles"in params||(params.bubbles=!0),"cancelable"in params||(params.cancelable=!0);try{event=knownEventModules[module].create(evt,params)}catch(e){event=document.createEvent(knownEventModules[module].name||module),knownEventModules[module].init(event,evt,params)}return elem.dispatchEvent(event)}},delegate:function(sel,handler){return sel=sel.trim().split(/\s*,\s*/g).map(function(s){var m=s.match(/^(?:(?:#([^\s\[>+:.]+)\s+)?\.([^\s\[>+:]+)|#([^\s\[>+:.]+))$/);return[m[1]||m[3],m[2]]}),function(evt){if(evt.target){for(var i,j,elems=[],ids=[],classes=[],found=[],elem=evt.target;elems.push(elem),ids.push(elem.id),classes.push(((elem.className||"")+"").trim().split(/\s+/g)),elem=elem.parentNode;);for(i=0;i<elems.length;i++)for(j=0;j<sel.length;j++)sel[j][1]&&!(-1<classes[i].indexOf(sel[j][1]))||sel[j][0]&&!(sel[j][1]?ids.indexOf(sel[j][0])>i:ids[i]===sel[j][0])||found.push(elems[i]);for(i=0;i<found.length;i++)handler.call(found[i],evt,found[i])}}},getData:function(elem,key,def){return key="data-"+key,(elem=getElem(elem)).hasAttribute(key)?function(value){if(!value)return null;try{return JSON.parse(value)}catch(e){return value}}(elem.getAttribute(key)):def},setData:function(elem,key,value){return map([elem],function(elem){return elem.setAttribute("data-"+key,JSON.stringify(value)),elem})},addClass:null,removeClass:null,toggleClass:null,hasClass:null},testElem=DOM.create("span"),prepare=function(args,asStr){return args=Arrays.createFrom(args,1).join(" ").trim(),asStr?args:args.split(/\s+/g)};"classList"in testElem?(testElem.classList.add("c1","c2"),testElem.classList.contains("c2")?(DOM.addClass=function(elem,classes){return classes=prepare(arguments),map([elem],function(elem){return elem.classList.add.apply(elem.classList,classes),elem})},DOM.removeClass=function(elem,classes){return classes=prepare(arguments),map([elem],function(elem){return elem.classList.remove.apply(elem.classList,classes),elem})}):(DOM.addClass=function(elem,classes){return classes=prepare(arguments),map([elem],function(elem){return classes.forEach(function(c){elem.classList.add(c)}),elem})},DOM.removeClass=function(elem,classes){return classes=prepare(arguments),map([elem],function(elem){return classes.forEach(function(c){elem.classList.remove(c)}),elem})}),testElem.classList.toggle("c1",!0),testElem.classList.contains("c1")?DOM.toggleClass=function(elem,classes,value){return classes=classes.trim().split(/\s+/g),map([elem],function(elem){return value===undefined?classes.forEach(function(c){elem.classList.toggle(c)}):classes.forEach(function(c){elem.classList.toggle(c,!!value)}),elem})}:DOM.toggleClass=function(elem,classes,value){return classes=classes.trim().split(/\s+/g),map([elem],function(elem){return classes.forEach(function(c){value!==undefined&&!value!==elem.classList.contains(c)||elem.classList.toggle(c)}),elem})},DOM.hasClass=function(elem,classes){elem=getElem(elem),classes=prepare(arguments);for(var i=0;i<classes.length;i++)if(!elem.classList.contains(classes[i]))return!1;return!0}):(DOM.addClass=function(elem,classes){return classes=prepare(arguments,!0),map([elem],function(elem){return elem.className+=(elem.className?" ":"")+classes,elem})},DOM.removeClass=function(elem,classes){return classes=prepare(arguments).map(Strings.escapeRegex),map([elem],function(elem){return elem.className&&(elem.className=elem.className.replace(new RegExp("(?:(?:^|\\s+)(?:"+classes.join("|")+"))+(?=\\s+|$)","g")," ").trim().replace(/\s\s+/g," ")),elem})},DOM.toggleClass=function(elem,classes,value){return classes=classes.trim().split(/\s+/g),map([elem],function(elem){var current=(elem.className||"").trim().split(/\s+/g);return classes.forEach(function(c){var i=current.indexOf(c),has=-1<i;!1===value||has?!0!==value&&has&&current.splice(i,1):current.push(c)}),elem.className=current.join(" "),elem})},DOM.hasClass=function(elem,classes){if(!(elem=getElem(elem)).className)return!1;classes=prepare(arguments);for(var current=elem.className.trim().split(/\s+/g),i=0;i<classes.length;i++)if(-1===current.indexOf(classes[i]))return!1;return!0}),testElem=null,_context.register(DOM,"DOM")}),_context.invoke("Utils",function(DOM){var CSSTransitions={support:"getComputedStyle"in window,getDuration:function(elements){Array.isArray(elements)||(elements=[elements]);var durations=DOM.getStyle(elements,"animationDuration").concat(DOM.getStyle(elements,"transitionDuration")).map(function(d){return d?Math.max.apply(null,d.split(/\s*,\s*/g).map(function(v){return(v=v.match(/^((?:\d*\.)?\d+)(m?s)$/))?parseFloat(v[1])*("ms"===v[2]?1:1e3):0})):0});return durations.length?Math.max.apply(null,durations):0},run:function(elements,classes,forceLayout){return CSSTransitions.support&&(Array.isArray(elements)?elements.length:elements)?CSSTransitions._resolve(elements,classes,forceLayout):Promise.resolve(elements)},_resolve:function(elements,classes,forceLayout){if(forceLayout)window.pageXOffset;classes&&classes.add&&DOM.addClass(elements,classes.add),classes&&classes.remove&&DOM.removeClass(elements,classes.remove);var duration=CSSTransitions.getDuration(elements);return new Promise(function(fulfill){window.setTimeout(function(){classes&&classes.add&&DOM.removeClass(elements,classes.add),classes&&classes.after&&DOM.addClass(elements,classes.after),fulfill(elements)},duration)})}};if(CSSTransitions.support)try{var s=DOM.create("span").style;CSSTransitions.support=["transition","WebkitTransition","MozTransition","msTransition","OTransition"].some(function(prop){return prop in s}),s=null}catch(e){}_context.register(CSSTransitions,"CSSTransitions")}),_context.invoke("Utils",function(undefined){var ReflectionClass=function(c){this._={reflectedClass:"string"==typeof c?ReflectionClass.getClass(c):c}};ReflectionClass.from=function(c){return c instanceof ReflectionClass?c:new ReflectionClass(c)},ReflectionClass.getClass=function(name){return _context.lookup(name)},ReflectionClass.getClassName=function(obj,need){var className=_context.lookupClass(obj);if(!1===className&&need)throw new Error("Unknown class");return className},ReflectionClass.prototype.hasProperty=function(name){return this._.reflectedClass.prototype[name]!==undefined&&"function"!=typeof this._.reflectedClass.prototype[name]},ReflectionClass.prototype.hasMethod=function(name){return this._.reflectedClass.prototype[name]!==undefined&&"function"==typeof this._.reflectedClass.prototype[name]},ReflectionClass.prototype.newInstance=function(){return this.newInstanceArgs(arguments)},ReflectionClass.prototype.newInstanceArgs=function(args){var inst,ret,tmp=function(){};return tmp.prototype=this._.reflectedClass.prototype,inst=new tmp,ret=this._.reflectedClass.apply(inst,args),Object(ret)===ret?ret:inst},_context.register(ReflectionClass,"ReflectionClass")}),_context.invoke("Utils",function(Arrays,undefined){var ReflectionFunction=function(f){this._={reflectedFunction:f,argsList:null,name:null};var parts=f.toString().match(/^\s*function(?:\s*|\s+([^\(]+?)\s*)\(\s*([\s\S]*?)\s*\)/i);this._.name=parts[1]||null,this._.argsList=parts[2]?parts[2].replace(/\/\*\*?[\s\S]*?\*\//g,"").trim().split(/\s*,\s*/):[]};ReflectionFunction.from=function(f){return f instanceof ReflectionFunction?f:new ReflectionFunction(f)},ReflectionFunction.prototype.getName=function(){return this._.name},ReflectionFunction.prototype.getArgs=function(){return this._.argsList},ReflectionFunction.prototype.invoke=function(context){var args=Arrays.createFrom(arguments);return args.shift(),this._.reflectedFunction.apply(context,args)},ReflectionFunction.prototype.invokeArgs=function(context,args){for(var list=[],i=0;i<this._.argsList.length;i++){if(args[this._.argsList[i]]===undefined)throw new Error('Parameter "'+this._.argsList[i]+'" was not provided in argument list');list.push(args[this._.argsList[i]])}return this._.reflectedFunction.apply(context,list)},_context.register(ReflectionFunction,"ReflectionFunction")}),_context.invoke("Nittro",function(){function prepare(self,need){if(!self._){if(!1===need)return!1;self._={}}if(!self._.eventEmitter){if(!1===need)return!1;self._.eventEmitter={listeners:{},defaultListeners:{},namespaces:[]}}}function process(emitter,evt,op,arg1,arg2){(evt=(evt||"").replace(/^\s+|\s+$/g,"").split(/\s+/g)).forEach(function(e){var dflt=e.split(/:/),ns=dflt[0].split(/\./g);e=ns.shift(),(ns=function(emitter,namespaces){return namespaces.map(function(ns){var i=emitter.namespaces.indexOf(ns);return-1<i||(i=emitter.namespaces.length,emitter.namespaces.push(ns)),i})}(emitter,ns)).sort(),op(emitter,e,ns,"default"===dflt[1],arg1,arg2)})}function add(emitter,evt,ns,dflt,handler,mode){if(!evt)throw new TypeError("No event specified");if(dflt){if(0!==mode||ns.length)throw new TypeError("Default event handlers don't support namespaces and one()/first()");if(emitter.defaultListeners.hasOwnProperty(evt))throw new TypeError("Event '"+evt+"' already has a default listener");emitter.defaultListeners[evt]=handler}else 2===mode&&ns.unshift(emitter.namespaces.length),emitter.listeners[evt]||(emitter.listeners[evt]=[]),emitter.listeners[evt].push({handler:handler,namespaces:ns,mode:mode})}function remove(emitter,evt,ns,dflt,handler){if(evt)dflt?!emitter.defaultListeners.hasOwnProperty(evt)||handler&&emitter.defaultListeners[evt]!==handler||delete emitter.defaultListeners[evt]:emitter.listeners[evt]&&(ns.length?emitter.listeners[evt]=emitter.listeners[evt].filter(function(listener){return!(!handler||listener.handler===handler)||(!listener.namespaces.length||!function(a,b){for(var i=0,j=0;i<a.length&&j<b.length;)if(a[i]<b[j])i++;else{if(!(a[i]>b[j]))return!0;j++}return!1}(listener.namespaces,ns))}):handler?emitter.listeners[evt]=emitter.listeners[evt].filter(function(listener){return listener.handler!==handler}):(emitter.listeners.hasOwnProperty(evt)&&delete emitter.listeners[evt],emitter.defaultListeners.hasOwnProperty(evt)&&delete emitter.defaultListeners[evt]));else{var listeners=dflt?emitter.defaultListeners:emitter.listeners;for(evt in listeners)listeners.hasOwnProperty(evt)&&remove(emitter,evt,ns,dflt,handler)}}function triggerDefault(self,_,evt,e){!e.isDefaultPrevented()&&_.defaultListeners.hasOwnProperty(evt)&&_.defaultListeners[evt].call(self,e)}var NittroEventEmitter={on:function(evt,handler){return prepare(this),process(this._.eventEmitter,evt,add,handler,0),this},one:function(evt,handler){return prepare(this),process(this._.eventEmitter,evt,add,handler,1),this},first:function(evt,handler){return prepare(this),process(this._.eventEmitter,evt,add,handler,2),this._.eventEmitter.namespaces.push(null),this},off:function(evt,handler){return!1===prepare(this,!1)||process(this._.eventEmitter,evt,remove,handler),this},trigger:function(evt,data){return prepare(this),function(self,evt,data){var e,_=self._.eventEmitter;return"object"==typeof evt?evt=(e=evt).type:e=new NittroEvent(self,evt,data),_.listeners.hasOwnProperty(evt)&&_.listeners[evt].slice().forEach(function(listener){1===listener.mode?remove(_,evt,[],!1,listener.handler):2===listener.mode&&remove(_,"",[listener.namespaces[0]],!1),listener.handler.call(self,e)}),e.isAsync()?e.then(function(){triggerDefault(self,_,evt,e)},function(){}):triggerDefault(self,_,evt,e),e}(this,evt,data)}},NittroEvent=_context.extend(function(target,type,data){this.target=target,this.type=type,this.data=data||{},this._={defaultPrevented:!1,async:!1,queue:null,promise:null}},{preventDefault:function(){return this._.defaultPrevented=!0,this},isDefaultPrevented:function(){return this._.defaultPrevented},waitFor:function(promise){if(this._.promise)throw new Error("The event's queue has already been frozen");return this._.queue||(this._.queue=[]),this._.queue.push(promise),this._.async=!0,this},isAsync:function(){return this._.async},then:function(onfulfilled,onrejected){return this._.promise||(this._.promise=this._.queue?Promise.all(this._.queue):Promise.resolve(),this._.queue=null),this._.promise.then(onfulfilled,onrejected)}});_context.register(NittroEventEmitter,"EventEmitter"),_context.register(NittroEvent,"Event")}),_context.invoke("Nittro",function(){var prepare=function(self,need){if(!self._){if(!1===need)return!1;self._={}}if(!self._.hasOwnProperty("frozen")){if(!1===need)return!1;self._.frozen=!1}},Freezable={freeze:function(){return prepare(this),this._.frozen=!0,this},isFrozen:function(){return!1!==prepare(this,!1)&&this._.frozen},_updating:function(prop){if(!1===prepare(this,!1))return this;if(this._.frozen){var className=_context.lookupClass(this)||"object";throw prop&&(prop=' "'+prop+'"'),new Error("Cannot update property"+prop+" of a frozen "+className)}return this}};_context.register(Freezable,"Freezable")}),_context.invoke("Nittro",function(){var Object=_context.extend(function(){this._={}},{});_context.mixin(Object,"Nittro.EventEmitter"),_context.register(Object,"Object")}),_context.invoke("Utils",function(Utils,undefined){var DateInterval=function(interval,locale){this._={initialized:!1,interval:interval,locale:locale||Utils.DateTime.defaultLocale}};DateInterval.from=function(interval,locale){return new DateInterval(interval,locale)};var intervals=["year","month","week","day","hour","minute","second","millisecond"],intervalLengths={year:31536e6,month:26784e5,week:6048e5,day:864e5,hour:36e5,minute:6e4,second:1e3,millisecond:1};function getValue(interval){return"number"==typeof interval?interval:interval instanceof DateInterval?interval.getLength():DateInterval.from(interval).getLength()}DateInterval.prototype.add=function(interval){return this._initialize(),this._.interval+=getValue(interval),this},DateInterval.prototype.subtract=function(interval){return this._initialize(),this._.interval-=getValue(interval),this},DateInterval.prototype.isNegative=function(){return this._initialize(),this._.interval<0},DateInterval.prototype.getLength=function(){return this._initialize(),this._.interval},DateInterval.prototype.valueOf=function(){return this.getLength()},DateInterval.prototype.format=function(pattern){return this._initialize(),"boolean"!=typeof pattern&&"number"!=typeof pattern&&pattern?function(interval,pattern){var sign=interval<0?"-":"+";return interval=Math.abs(interval),(pattern+"").replace(/%(.)/g,function(m,f){var v,pad=!1;switch(f){case"%":return"%";case"y":m=intervalLengths.year;break;case"w":m=intervalLengths.week;break;case"m":pad=!0;case"n":m=intervalLengths.month;break;case"d":pad=!0;case"j":m=intervalLengths.day;break;case"H":pad=!0;case"G":m=intervalLengths.hour;break;case"i":pad=!0;case"I":m=intervalLengths.minute;break;case"s":pad=!0;case"S":m=intervalLengths.second;break;case"-":return"-"===sign?sign:"";case"+":return sign;default:throw new Error("Unknown format modifier: %"+f)}return v=Math.floor(interval/m),interval-=m*v,pad&&v<10?"0"+v:v})}(this._.interval,pattern):function(interval,precision,locale){!0===precision?precision=8:precision||(precision=2);var v,last,str=[],sign="";return interval<0&&(sign="-",interval=-interval),intervals.some(function(i){if(intervalLengths[i]<=interval&&(v=interval/intervalLengths[i],v=0==--precision?Math.round(v):Math.floor(v),str.push(v+" "+Utils.DateTime.i18n.getInterval(locale,i,v)),interval-=v*intervalLengths[i],0===precision))return!0}),2<str.length?(last=str.pop(),sign+str.join(", ")+" "+Utils.DateTime.i18n.getConjuction(locale)+" "+last):sign+str.join(" "+Utils.DateTime.i18n.getConjuction(locale)+" ")}(this._.interval,pattern,this._.locale)},DateInterval.prototype._initialize=function(){if(!this._.initialized&&(this._.initialized=!0,"number"!=typeof this._.interval)){var interval=this._.interval;if(interval instanceof DateInterval)this._.interval=interval.getLength();else{if("string"!=typeof interval)throw new Error("Invalid interval specification, expected string, number or a DateInterval instance");if(interval.match(/^\s*(?:\+|-)?\s*\d+\s*$/))this._.interval=parseInt(interval.trim());else{var rest,res=0;if((rest=interval.replace(Utils.DateTime.i18n.getIntervalParser(this._.locale),function(_,sign,n,y,m,w,d,h,i,s,u){return sign="-"===sign?-1:1,n=parseInt(n)*sign,y&&(n*=intervalLengths.year),m&&(n*=intervalLengths.month),w&&(n*=intervalLengths.week),d&&(n*=intervalLengths.day),h&&(n*=intervalLengths.hour),i&&(n*=intervalLengths.minute),s&&(n*=intervalLengths.second),u&&(n*=intervalLengths.millisecond),res+=n,""})).length)throw new Error('Invalid interval specification "'+interval+'", didn\'t understand "'+rest+'"');this._.interval=res}}}},_context.register(DateInterval,"DateInterval")}),_context.invoke("Utils",function(Strings,Arrays,DateInterval,undefined){var DateTime=function(d,locale){this._={initialized:!1,date:d||new Date,locale:locale||DateTime.defaultLocale}};DateTime.defaultLocale="en",DateTime.from=function(s,locale){return new DateTime(s,locale)},DateTime.now=function(){return new DateTime},DateTime.isDateObject=function(o){return"object"==typeof o&&o&&o.date!==undefined&&o.timezone!==undefined&&o.timezone_type!==undefined},DateTime.isLeapYear=function(y){return y%4==0&&y%100!=0||y%400==0},DateTime.isModifyString=function(str,locale){return DateTime.i18n.getParser(locale||DateTime.defaultLocale).test(str)},DateTime.getDaysInMonth=function(m,y){for(;m<0;)m+=12,y--;for(;12<m;)m-=12,y++;return 1===m?DateTime.isLeapYear(y)?29:28:m in{3:1,5:1,8:1,10:1}?30:31};var ni=function(){throw new Error("Not implemented!")},pad=function(n){return n<10?"0"+n:n},formatTz=function(offset){return("string"==typeof offset||offset instanceof String)&&offset.match(/(\+|-)\d\d:\d\d/)?offset:("number"!=typeof offset&&(offset=parseInt(offset)),(offset<0?"+":"-")+pad(parseInt(Math.abs(offset)/60))+":"+pad(Math.abs(offset)%60))};DateTime.getLocalTzOffset=function(){return formatTz((new Date).getTimezoneOffset())},DateTime.formatModifiers={d:function(d,u){return pad(u?d.getUTCDate():d.getDate())},D:function(d,u,o){return DateTime.i18n.getWeekday(o,u?d.getUTCDay():d.getDay(),!0)},j:function(d,u){return u?d.getUTCDate():d.getDate()},l:function(d,u,o){return DateTime.i18n.getWeekday(o,u?d.getUTCDay():d.getDay())},N:function(d,u,n){return 0===(n=u?d.getUTCDay():d.getDay())?7:n},S:function(d,u,n){return n=u?d.getUTCDate():d.getDate(),0===(n%=10)||3<n?"th":["st","nd","rd"][n-1]},w:function(d,u){return u?d.getUTCDay():d.getDay()},z:function(d,u,n,m,y,M){for(n=u?d.getUTCDate():d.getDate(),n--,y=u?d.getUTCFullYear():d.getFullYear(),m=0,M=u?d.getUTCMonth():d.getMonth();m<M;)n+=DateTime.getDaysInMonth(m++,y);return n},W:ni,F:function(d,u,o){return DateTime.i18n.getMonth(o,u?d.getUTCMonth():d.getMonth())},m:function(d,u){return pad((u?d.getUTCMonth():d.getMonth())+1)},M:function(d,u,o){return DateTime.i18n.getMonth(o,u?d.getUTCMonth():d.getMonth(),!0)},n:function(d,u){return(u?d.getUTCMonth():d.getMonth())+1},t:function(d,u){return DateTime.getDaysInMonth(u?d.getUTCMonth():d.getMonth(),u?d.getUTCFullYear():d.getFullYear())},L:function(d,u){return DateTime.isLeapYear(u?d.getUTCFullYear():d.getFullYear())?1:0},o:ni,Y:function(d,u){return u?d.getUTCFullYear():d.getFullYear()},y:function(d,u){return(u?d.getUTCFullYear():d.getFullYear()).toString().substr(-2)},a:function(d,u,h){return 0<=(h=u?d.getUTCHours():d.getHours())&&h<12?"am":"pm"},A:function(d,u){return DateTime.formatModifiers.a(d,u).toUpperCase()},g:function(d,u,h){return 0===(h=u?d.getUTCHours():d.getHours())?12:12<h?h-12:h},G:function(d,u){return u?d.getUTCHours():d.getHours()},h:function(d,u){return pad(DateTime.formatModifiers.g(d,u))},H:function(d,u){return pad(u?d.getUTCHours():d.getHours())},i:function(d,u){return pad(u?d.getUTCMinutes():d.getMinutes())},s:function(d,u){return pad(u?d.getUTCSeconds():d.getSeconds())},u:function(d,u){return 1e3*(u?d.getUTCMilliseconds():d.getMilliseconds())},e:ni,I:ni,O:function(d,u){return DateTime.formatModifiers.P(d,u).replace(":","")},P:function(d,u){return u?"+00:00":formatTz(d.getTimezoneOffset())},T:ni,Z:function(d,u){return u?0:-60*d.getTimezoneOffset()},c:function(d,u){return DateTime.from(d).format("Y-m-d\\TH:i:sP",u)},r:function(d,u){return DateTime.from(d).format("D, n M Y G:i:s O",u)},U:function(d){return Math.round(d.getTime()/1e3)}},DateTime.prototype.format=function(f,utc){this._initialize();var date=this._.date,locale=this._.locale,pattern=Arrays.getKeys(DateTime.formatModifiers).map(Strings.escapeRegex).join("|"),re=new RegExp("(\\\\*)("+pattern+")","g");return f.replace(re,function(s,c,m){return c.length%2?c.substr(1)+m:c+""+DateTime.formatModifiers[m](date,utc,locale)})},DateTime.prototype.getLocale=function(){return this._.locale},DateTime.prototype.setLocale=function(locale){if(!DateTime.i18n.hasLocale(locale))throw new Error("Unknown locale: "+locale);return this._.locale=locale,this},["getTime","getDate","getDay","getMonth","getFullYear","getHours","getMinutes","getSeconds","getMilliseconds","getTimezoneOffset","getUTCDate","getUTCDay","getUTCMonth","getUTCFullYear","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleFormat","toLocaleTimeString","toString","toTimeString","toUTCString"].forEach(function(method){DateTime.prototype[method]=function(){return this._initialize(),this._.date[method].apply(this._.date,arguments)}}),["setTime","setDate","setMonth","setFullYear","setHours","setMinutes","setSeconds","setMilliseconds","setUTCDate","setUTCMonth","setUTCFullYear","setUTCHours","setUTCMinutes","setUTCSeconds","setUTCMilliseconds"].forEach(function(method){DateTime.prototype[method]=function(){return this._initialize(),this._.date[method].apply(this._.date,arguments),this}}),DateTime.prototype.getTimestamp=function(){return this._initialize(),Math.round(this._.date.getTime()/1e3)},DateTime.prototype.getDateObject=function(){return this._initialize(),this._.date},DateTime.prototype.valueOf=function(){return this.getTimestamp()},DateTime.prototype.modify=function(s){this._initialize();var parts,dt,i,o,t=this._.date.getTime();if(s instanceof DateInterval)return this._.date=new Date(t+s.getLength()),this;if(!(parts=DateTime.i18n.getParser(this._.locale).exec(s.toLowerCase())))throw new Error("Invalid interval expression: "+s);if(parts[1])t=Date.now();else if(parts[2])t-=864e5;else if(parts[3])(dt=new Date).setHours(this._.date.getHours(),this._.date.getMinutes(),this._.date.getSeconds(),this._.date.getMilliseconds()),t=dt.getTime();else if(parts[4])t+=864e5;else if(parts[5]||parts[6])dt=new Date(t),o=parts[7]?-1:parts[9]?1:0,parts[10]?dt.setFullYear(dt.getFullYear()+o,parts[5]?0:11,parts[5]?1:31):parts[11]?dt.setMonth(dt.getMonth()+o,parts[5]?1:DateTime.getDaysInMonth(dt.getMonth()+o,dt.getFullYear())):dt.setDate(dt.getDate()-dt.getDay()+DateTime.i18n.getWeekStart(this._.locale)+7*o+(parts[5]?0:6)),t=dt.getTime();else if(parts[13]||parts[14]||parts[15]){for(dt=new Date(t),o=parts[13]?-1:parts[15]?1:0,i=16;i<35&&!parts[i];i++);i<28?(i-=16,dt.setMonth(12*o+i,1)):((i-=28)<DateTime.i18n.getWeekStart(this._.locale)&&(i+=7),dt.setDate(dt.getDate()-dt.getDay()+7*o+i)),t=dt.getTime()}return parts[35]||parts[36]?((dt=new Date(t)).setHours(parts[36]?0:12,0,0,0),t=dt.getTime()):parts[37]&&(dt=new Date(t),(o=parts[37].match(/^(\d+)(?::(\d+)(?::(\d+))?)?\s*([ap]m)?/i))[1]=parseInt(o[1].replace(/^0(\d)$/,"$1")),12===o[1]&&"am"===o[4]?o[1]=0:o[1]<12&&"pm"===o[4]&&(o[1]+=12),o[2]=o[2]!==undefined?parseInt(o[2].replace(/^0(\d)$/,"$1")):0,o[3]=o[3]!==undefined?parseInt(o[3].replace(/^0(\d)$/,"$1")):0,dt.setHours(o[1],o[2],o[3],0),t=dt.getTime()),parts[38]&&(t+=DateInterval.from(parts[38],this._.locale).getLength()),this._.date=new Date(t),this},DateTime.prototype.modifyClone=function(s){return DateTime.from(this).modify(s)},DateTime.prototype._initialize=function(){var m,s;this._.initialized||(this._.initialized=!0,"string"==typeof this._.date?(m=this._.date.match(/^@(\d+)$/))?this._.date=new Date(1e3*m[1]):(m=this._.date.match(/^(\d\d\d\d-\d\d-\d\d)[ T](\d\d:\d\d(?::\d\d(?:\.\d+)?)?)([-+]\d\d:?\d\d)?$/))?this._.date=new Date(m[1]+"T"+m[2]+(m[3]||"")):DateTime.isModifyString(this._.date,this._.locale)?(s=this._.date,this._.date=new Date,this.modify(s)):this._.date=new Date(this._.date):"number"==typeof this._.date?this._.date=new Date(this._.date):DateTime.isDateObject(this._.date)?(s=this._.date.date,3===this._.date.timezone_type&&"UTC"!==this._.date.timezone||(s+=" "+this._.date.timezone),this._.date=new Date(s)):this._.date instanceof DateTime&&(this._.locale=this._.date.getLocale(),this._.date=new Date(this._.date.getTime())))},_context.register(DateTime,"DateTime")}),_context.invoke("Utils",function(DateTime,Strings){var i18n=DateTime.i18n={locales:{},hasLocale:function(locale){return locale in i18n.locales},getLocale:function(locale){if(!i18n.hasLocale(locale))throw new Error("Unknown locale: "+locale);return i18n.locales[locale]},getMonth:function(locale,m,abbrev){return i18n.getLocale(locale).keywords.months[abbrev?"abbrev":"full"][m]},getWeekday:function(locale,d,abbrev){return i18n.getLocale(locale).keywords.weekdays[abbrev?"abbrev":"full"][d]},getConjuction:function(locale){return i18n.getLocale(locale).keywords.conjuction},getInterval:function(locale,unit,n){return n=(locale=i18n.getLocale(locale)).getPlural(n),locale.keywords.intervals[unit][n]},getWeekStart:function(locale){return i18n.getLocale(locale).weekStart},getParser:function(locale){return(locale=i18n.getLocale(locale)).parser||(locale.parser=function(locale){var i;if(!("months"in locale.parsers))for(locale.parsers.months=[],i=0;i<12;i++)locale.parsers.months.push(Strings.escapeRegex(locale.keywords.months.full[i])+"|"+Strings.escapeRegex(locale.keywords.months.abbrev[i]));if(!("weekdays"in locale.parsers))for(locale.parsers.weekdays=[],i=0;i<7;i++)locale.parsers.weekdays.push(Strings.escapeRegex(locale.keywords.weekdays.full[i])+"|"+Strings.escapeRegex(locale.keywords.weekdays.abbrev[i]));var parts=["^","(?:","(?:","(",locale.parsers.now,")|","(",locale.parsers.yesterday,")|","(",locale.parsers.today,")|","(",locale.parsers.tomorrow,")|","(?:","(",locale.parsers.firstOf,")|","(",locale.parsers.lastOf,")",")\\s+(?:","(",locale.parsers.last,")|","(",locale.parsers.this,")|","(",locale.parsers.next,")",")\\s+(?:","(",locale.parsers.year,")|","(",locale.parsers.month,")|","(",locale.parsers.week,")",")","|","(?:","(",locale.parsers.last,")|","(",locale.parsers.this,")|","(",locale.parsers.next,")",")\\s+(?:","(",locale.parsers.months.join(")|("),")","|","(",locale.parsers.weekdays.join(")|("),")",")",")(?:\\s+|$)",")?","(?:","(?:",locale.parsers.at,"\\s+)?","(?:","(",locale.parsers.noon,")|","(",locale.parsers.midnight,")|","([012]?\\d(?::[0-5]\\d(?::[0-5]\\d)?)?(?:\\s*[ap]m)?)",")","(?=[-+]|\\s|$)",")?","(","(?:","\\s*[-+]?\\s*\\d+\\s+","(?:",locale.parsers.intervals.year,"|",locale.parsers.intervals.month,"|",locale.parsers.intervals.week,"|",locale.parsers.intervals.day,"|",locale.parsers.intervals.hour,"|",locale.parsers.intervals.minute,"|",locale.parsers.intervals.second,"|",locale.parsers.intervals.millisecond,")","(?=[-+]|\\s|$)",")*",")","$"];return new RegExp(parts.join(""),"i")}(locale)),locale.parser},getIntervalParser:function(locale){return(locale=i18n.getLocale(locale)).intervalParser||(locale.intervalParser=function(locale){var parts=["\\s*([-+]?)\\s*(\\d+)\\s+","(?:","(",locale.parsers.intervals.year,")|","(",locale.parsers.intervals.month,")|","(",locale.parsers.intervals.week,")|","(",locale.parsers.intervals.day,")|","(",locale.parsers.intervals.hour,")|","(",locale.parsers.intervals.minute,")|","(",locale.parsers.intervals.second,")|","(",locale.parsers.intervals.millisecond,")",")\\s*"];return new RegExp(parts.join(""),"ig")}(locale)),locale.intervalParser}}}),_context.invoke("Utils",function(DateTime){DateTime.i18n.locales.en={getPlural:function(n){return 1===n?0:1},weekStart:0,keywords:{weekdays:{abbrev:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{abbrev:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],full:["January","February","March","April","May","June","July","August","September","October","November","December"]},intervals:{year:["year","years"],month:["month","months"],week:["week","weeks"],day:["day","days"],hour:["hour","hours"],minute:["minute","minutes"],second:["second","seconds"],millisecond:["millisecond","milliseconds"]},conjuction:"and"},parsers:{now:"now",today:"today",tomorrow:"tomorrow",yesterday:"yesterday",at:"at",noon:"noon",midnight:"midnight",last:"last",this:"this",next:"next",firstOf:"first(?:\\s+day)?\\s+of",lastOf:"last(?:\\s+day)?\\s+of",year:"year",month:"month",week:"week",intervals:{year:"y(?:ears?)?",month:"mon(?:ths?)?",week:"w(?:eeks?)?",day:"d(?:ays?)?",hour:"h(?:ours?)?",minute:"min(?:utes?)?",second:"s(?:ec(?:onds?)?)?",millisecond:"millis(?:econds?)?|ms"}}}}),_context.invoke("Nittro.Utils",function(Nittro,Strings,Arrays,HashMap,undefined){var Tokenizer=_context.extend(function(patterns,matchCase){var types=!1;if(!Array.isArray(patterns))if(patterns instanceof HashMap)types=patterns.getKeys(),patterns=patterns.getValues();else{var type,tmp=patterns;for(type in types=[],patterns=[],tmp)tmp.hasOwnProperty(type)&&(types.push(type),patterns.push(tmp[type]))}this._={pattern:"("+patterns.join(")|(")+")",types:types,matchCase:matchCase}},{STATIC:{getCoordinates:function(text,offset){var m=(text=text.substr(0,offset)).match(/\n/g);return[(m?m.length:0)+1,offset-("\n"+text).lastIndexOf("\n")+1]}},tokenize:function(input){var re,tokens,pos,n;return this._.types?(re=new RegExp(this._.pattern,"gm"+(this._.matchCase?"":"i")),tokens=[],pos=0,n=this._.types.length,input.replace(re,function(){var i,ofs=arguments[n+1];for(pos<ofs&&tokens.push([input.substr(pos,ofs-pos),pos,null]),i=1;i<=n;i++)if(arguments[i]!==undefined)return tokens.push([arguments[i],ofs,this._.types[i-1]]),void(pos=ofs+arguments[0].length);throw new Error("Unknown token type: "+arguments[0])}.bind(this)),pos+1<input.length&&tokens.push([input.substr(pos),pos,null])):tokens=Strings.split(input,new RegExp(this._.pattern,"m"+(this._.matchCase?"":"i")),!0,!0,!0),tokens}});_context.register(Tokenizer,"Tokenizer")},{Strings:"Utils.Strings",Arrays:"Utils.Arrays",HashMap:"Utils.HashMap"}),_context.invoke("Nittro.Neon",function(Nittro,HashMap,Tokenizer,Strings,Arrays,DateTime,undefined){var Neon=_context.extend(function(){this._cbStr=this._cbStr.bind(this)},{STATIC:{patterns:["'[^'\\n]*'|\"(?:\\\\.|[^\"\\\\\\n])*\"","(?:[^#\"',:=[\\]{}()\0- !`-]|[:-][^\"',\\]})\\s])(?:[^,:=\\]})(\0- ]|:(?![\\s,\\]})]|$)|[ \\t]+[^#,:=\\]})(\0- ])*","[,:=[\\]{}()-]","?:#.*","\\n[\\t ]*","?:[\\t ]+"],brackets:{"{":"}","[":"]","(":")"},consts:{true:!0,True:!0,TRUE:!0,yes:!0,Yes:!0,YES:!0,on:!0,On:!0,ON:!0,false:!1,False:!1,FALSE:!1,no:!1,No:!1,NO:!1,off:!1,Off:!1,OFF:!1,null:null,Null:null,NULL:null},indent:"    ",BLOCK:1,encode:function(data,options){var tmp,s,isList;return data instanceof DateTime?data.format("Y-m-d H:i:s O"):data instanceof NeonEntity?(tmp=Neon.encode(data.attributes),Neon.encode(data.value)+"("+tmp.substr(1,tmp.length-2)+")"):data&&"object"==typeof data?(s=[],isList=Array.isArray(data),options&Neon.BLOCK?(Arrays.walk(data,function(k,v){v=Neon.encode(v,Neon.BLOCK),s.push(isList?"-":Neon.encode(k)+":",Strings.contains(v,"\n")?"\n"+Neon.indent+v.replace(/\n/g,"\n"+Neon.indent):" "+v,"\n")}),s.length?s.join(""):"[]"):(Arrays.walk(data,function(k,v){s.push(isList?"":Neon.encode(k)+": ",Neon.encode(v),", ")}),s.pop(),(isList?"[":"{")+s.join("")+(isList?"]":"}"))):"string"!=typeof data||Strings.isNumeric(data)||data.match(/[\x00-\x1F]|^\d{4}|^(true|false|yes|no|on|off|null)$/i)||!data.match(new RegExp("^"+Neon.patterns[1]+"$"))?JSON.stringify(data):data},decode:function(input){if("string"!=typeof input)throw new Error("Invalid argument, must be a string");Neon.tokenizer||(Neon.tokenizer=new Tokenizer(Neon.patterns)),input=input.replace(/\r/g,"");var res,parser=new Neon;for(parser.input=input,parser.tokens=Neon.tokenizer.tokenize(input),res=parser.parse(0,new HashMap);parser.tokens[parser.n]!==undefined;)"\n"===parser.tokens[parser.n][0].charAt(0)?parser.n++:parser.error();return res}},input:null,tokens:null,n:0,indentTabs:null,parse:function(indent,result){indent===undefined&&(indent=null),result===undefined&&(result=new HashMap);for(var t,inlineParser=null===indent,value=null,key=null,entity=null,hasValue=!1,hasKey=!1;this.n<this.tokens.length;this.n++)if(","===(t=this.tokens[this.n][0]))(hasKey||hasValue)&&inlineParser||this.error(),this.addValue(result,hasKey,key,hasValue?value:null),hasKey=hasValue=!1;else if(":"===t||"="===t)!hasKey&&hasValue||this.error(),"string"!=typeof value&&"number"!=typeof value&&this.error("Unacceptable key"),key=Strings.toString(value),hasValue=!(hasKey=!0);else if("-"===t)(hasKey||hasValue||inlineParser)&&this.error(),hasKey=!(key=null);else if(Neon.brackets[t]!==undefined)value=hasValue?("("!==t&&this.error(),this.n++,(entity=new NeonEntity).value=value,entity.attributes=this.parse(null,new HashMap),entity):(this.n++,this.parse(null,new HashMap)),hasValue=!0,this.tokens[this.n]!==undefined&&this.tokens[this.n][0]===Neon.brackets[t]||this.error();else{if("}"===t||"]"===t||")"===t){inlineParser||this.error();break}if("\n"===t.charAt(0))if(inlineParser)(hasKey||hasValue)&&(this.addValue(result,hasKey,key,hasValue?value:null),hasKey=hasValue=!1);else{for(;this.tokens[this.n+1]!==undefined&&"\n"===this.tokens[this.n+1][0].charAt(0);)this.n++;if(this.tokens[this.n+1]===undefined)break;var newIndent=this.tokens[this.n][0].length-1;if(null===indent&&(indent=newIndent),newIndent&&(null===this.indentTabs&&(this.indentTabs="\t"===this.tokens[this.n][0].charAt(1)),Strings.contains(this.tokens[this.n][0],this.indentTabs?" ":"\t")&&(this.n++,this.error("Either tabs or spaces may be used for indentation, not both"))),indent<newIndent)hasValue||!hasKey?(this.n++,this.error("Unexpected indentation")):this.addValue(result,null!==key,key,this.parse(newIndent,new HashMap)),newIndent=this.tokens[this.n]!==undefined?this.tokens[this.n][0].length-1:0,hasKey=!1;else{if(hasValue&&!hasKey)break;hasKey&&(this.addValue(result,null!==key,key,hasValue?value:null),hasKey=hasValue=!1)}if(newIndent<indent)return result}else hasValue&&this.error(),value='"'===t.charAt(0)?t.substr(1,t.length-2).replace(/\\(?:u[0-9a-f]{4}|x[0-9a-f]{2}|.)/gi,this._cbStr):"'"===t.charAt(0)?t.substr(1,t.length-2):Neon.consts[t]!==undefined?Neon.consts[t]:Strings.isNumeric(t)?parseFloat(t):t.match(/^\d\d\d\d-\d\d?-\d\d?(?:(?:[Tt]| +)\d\d?:\d\d(?::\d\d(?:\.\d*)?)? *(?:Z|[-+]\d\d?(?::?\d\d)?)?)?$/)?DateTime.from(t):t,hasValue=!0}return inlineParser?(hasKey||hasValue)&&this.addValue(result,hasKey,key,hasValue?value:null):hasValue&&!hasKey?result.length?this.error():result=value:hasKey&&this.addValue(result,null!==key,key,hasValue?value:null),result},addValue:function(result,hasKey,key,value){hasKey?(result&&result.has(key)&&this.error("Duplicated key "+key),result.set(key,value)):result.push(value)},_cbStr:function(m){var mapping={t:"\t",n:"\n",r:"\r",f:"\f",b:"\b",'"':'"',"\\":"\\","/":"/",_:"Â "};return mapping[m.charAt(1)]!==undefined?mapping[m.charAt(1)]:"u"===m.charAt(1)&&6===m.length?String.fromCharCode(parseInt(m.substr(2),16)):"x"===m.charAt(1)&&4===m.length?String.fromCharCode(parseInt(m.substr(2),16)):void this.error("Invalid escape sequence "+m)},error:function(msg){var last=this.tokens[this.n]!==undefined?this.tokens[this.n]:null,pos=Tokenizer.getCoordinates(this.input,last?last[1]:this.input.length),token=last?last[0].substr(0,40).replace(/\n/g,"<new line>"):"end";throw new Error((msg||"Unexpected %s").replace(/%s/g,token)+" on line "+pos[0]+", column "+pos[1])}}),NeonEntity=function(value,attributes){this.value=value||null,this.attributes=attributes||null};_context.register(Neon,"Neon"),_context.register(NeonEntity,"NeonEntity")},{HashMap:"Utils.HashMap",Strings:"Utils.Strings",Arrays:"Utils.Arrays",DateTime:"Utils.DateTime",Tokenizer:"Nittro.Utils.Tokenizer"}),_context.invoke("Nittro.DI",function(undefined){var ServiceDefinition=_context.extend(function(factory,args,setup,run){this._={factory:factory,args:args||{},setup:setup||[],run:!!run}},{getFactory:function(){return this._.factory},setFactory:function(factory,args){return this._.factory=factory,args!==undefined&&(this._.args=args),this},getArguments:function(){return this._.args},setArguments:function(args){return this._.args=args,this},getSetup:function(){return this._.setup},hasSetup:function(){return 0<this._.setup.length},addSetup:function(callback){return this._.setup.push(callback),this},setRun:function(state){return this._.run=state===undefined||!!state,this},isRun:function(){return this._.run}});_context.register(ServiceDefinition,"ServiceDefinition")}),_context.invoke("Nittro.DI",function(Nittro,ReflectionClass,ReflectionFunction,Arrays,Strings,HashMap,Neon,NeonEntity,ServiceDefinition,undefined){var prepare=function(self){self._||(self._={}),self._.services||(self._.services={},self._.serviceDefs={})},ContainerMixin={addService:function(name,service){if(prepare(this),this._.services[name]||this._.serviceDefs[name])throw new Error('Container already has a service named "'+name+'"');return this._.services[name]=service,this},addServiceDefinition:function(name,definition,override){if(prepare(this),!override&&(this._.services[name]||this._.serviceDefs[name]))throw new Error('Container already has a service named "'+name+'"');return this._.serviceDefs[name]=definition,this},hasServiceDefinition:function(name){return prepare(this),this._.serviceDefs[name]!==undefined},getServiceDefinition:function(name){if(prepare(this),!this._.serviceDefs[name])throw new Error('Container has no service "'+name+'"');return"string"==typeof this._.serviceDefs[name]?this._.serviceDefs[name]=new ServiceDefinition(this._.serviceDefs[name].replace(/!$/,""),null,null,!!this._.serviceDefs[name].match(/!$/)):"function"==typeof this._.serviceDefs[name]?this._.serviceDefs[name]=new ServiceDefinition(this._.serviceDefs[name]):this._.serviceDefs[name]instanceof ServiceDefinition||(this._.serviceDefs[name]=new ServiceDefinition(this._.serviceDefs[name].factory,this._.serviceDefs[name].args,this._.serviceDefs[name].setup,this._.serviceDefs[name].run)),this._.serviceDefs[name]},getService:function(name){if(prepare(this),"container"===name)return this;if(this._.services[name]===undefined){if(!this._.serviceDefs[name])throw new Error('Container has no service named "'+name+'"');this._createService(name)}return this._.services[name]},hasService:function(name){return prepare(this),"container"===name||this._.services[name]!==undefined||this._.serviceDefs[name]!==undefined},isServiceCreated:function(name){if(!this.hasService(name))throw new Error('Container has no service named "'+name+'"');return!!this._.services[name]},runServices:function(){var name;for(name in prepare(this),this._.serviceDefs)this.getServiceDefinition(name).isRun()&&this.getService(name)},invoke:function(callback,args,thisArg){return prepare(this),args=this._autowireArguments(callback,args),callback.apply(thisArg||null,this._expandArguments(args))},_createService:function(name){var obj,service,setup,def=this.getServiceDefinition(name),factory=def.getFactory();if("function"==typeof factory){if(!(service=this.invoke(factory,def.getArguments())))throw new Error('Factory failed to create service "'+name+'"')}else if(factory=this._toEntity(factory),(service=this._expandEntity(factory,null,def.getArguments()))===factory)throw new Error('Invalid factory for service "'+name+'"');if(this._.services[name]=service,def.hasSetup()){setup=def.getSetup();for(var i=0;i<setup.length;i++)"function"==typeof setup[i]?this.invoke(setup[i],null,service):(obj=this._toEntity(setup[i]),this._expandEntity(obj,service))}return service},_autowireArguments:function(callback){var i,a,argList=ReflectionFunction.from(callback).getArgs(),args=Arrays.createFrom(arguments,1).filter(function(arg){return!!arg}).map(function(arg){return arg instanceof HashMap?arg.isList()&&(arg=HashMap.from(arg.getValues(),argList)):arg=HashMap.from(arg,argList),arg});lookupArg:for(i=0;i<argList.length;i++){for(a=args.length-1;0<=a;a--){if(args[a].has(argList[i])){argList[i]=args[a].get(argList[i]);continue lookupArg}if(args[a].has(i)){argList[i]=args[a].get(i);continue lookupArg}}if(!this.hasService(argList[i]))throw new Error('Cannot autowire argument "'+argList[i]+'" of function');argList[i]=this.getService(argList[i])}return argList},_expandArguments:function(args){for(var i=0;i<args.length;i++)args[i]=this._expandArg(args[i]);return args},_expandArg:function(arg){return arg instanceof NeonEntity?this._expandEntity(arg):"string"==typeof arg&&arg.match(/^@\S+$/)?this.getService(arg.substr(1)):arg},_toEntity:function(str){var m=str.match(/^([^\(]+)\((.*)\)$/);return m?new NeonEntity(m[1],Neon.decode("["+m[2]+"]")):new NeonEntity(str,new HashMap)},_expandEntity:function(entity,context,mergeArgs){var m,obj,method,args;if(m=entity.value.match(/^(?:(@)?([^:].*?))?(?:::(.+))?$/)){if(m[2])obj=m[1]?this.getService(m[2]):ReflectionClass.getClass(m[2]);else{if(!context)throw new Error("No context for calling "+entity.value+" given");obj=context}if(m[3]!==undefined)return method=m[3],args=this._autowireArguments(obj[method],entity.attributes,mergeArgs),obj[method].apply(obj,this._expandArguments(args));if(m[1]){if(entity.attributes.length)throw new Error('Invalid entity "'+entity.value+'"');return obj}return args=this._autowireArguments(obj,entity.attributes,mergeArgs),ReflectionClass.from(obj).newInstanceArgs(this._expandArguments(args))}return entity}};_context.register(ContainerMixin,"ContainerMixin")},{ReflectionClass:"Utils.ReflectionClass",ReflectionFunction:"Utils.ReflectionFunction",Arrays:"Utils.Arrays",Strings:"Utils.Strings",HashMap:"Utils.HashMap",Neon:"Nittro.Neon.Neon",NeonEntity:"Nittro.Neon.NeonEntity"}),_context.invoke("Nittro.DI",function(ContainerMixin,Arrays,HashMap,ReflectionClass,NeonEntity,undefined){function traverse(cursor,path,create){"string"==typeof path&&(path=path.split(/\./g));var i,p,n=path.length;for(i=0;i<n;i++){if(p=path[i],Array.isArray(cursor)&&p.match(/^\d+$/)&&(p=parseInt(p)),cursor[p]===undefined){if(!create)return undefined;cursor[p]={}}cursor=cursor[p]}return cursor}var Container=_context.extend(function(config){config||(config={}),this._={params:Arrays.mergeTree({},config.params||null),serviceDefs:Arrays.mergeTree({},config.services||null),services:{},factories:Arrays.mergeTree({},config.factories||null)}},{hasParam:function(name){return traverse(this._.params,name)!==undefined},getParam:function(name,def){var value=traverse(this._.params,name);return value!==undefined?value:def!==undefined?def:null},setParam:function(name,value){var p=(name=name.split(/\./g)).pop(),cursor=this._.params;return name.length&&(cursor=traverse(cursor,name,!0)),Array.isArray(cursor)&&p.match(/^\d+$/)&&(p=parseInt(p)),cursor[p]=value,this},hasFactory:function(name){return this._.factories[name]!==undefined},addFactory:function(name,factory,params){return this._.factories[name]="string"==typeof factory?factory:{callback:factory,params:params||null},this},create:function(name,args){if(!this.hasFactory(name))throw new Error('No factory named "'+name+'" has been registered');var factory=this._.factories[name];return"string"==typeof factory?this._.factories[name]=factory=this._toEntity(factory):factory.params instanceof HashMap||(factory.params=new HashMap(factory.params)),factory instanceof NeonEntity?this._expandEntity(factory,null,args):(args=this._autowireArguments(factory.callback,factory.params,args),factory.callback.apply(null,this._expandArguments(args)))},_expandArg:function(arg){return"string"==typeof arg&&-1<arg.indexOf("%")?arg.match(/^%[^%]+%$/)?this.getParam(arg.replace(/^%|%$/g,"")):arg.replace(/%([a-z0-9_.-]+)%/gi,function(){return this.getParam(arguments[1])}.bind(this)):this.__expandArg(arg)}});_context.mixin(Container,ContainerMixin,{_expandArg:"__expandArg"}),_context.register(Container,"Container")},{Arrays:"Utils.Arrays",HashMap:"Utils.HashMap",ReflectionClass:"Utils.ReflectionClass",NeonEntity:"Nittro.Neon.NeonEntity"}),_context.invoke("Nittro.DI",function(Arrays){var BuilderExtension=_context.extend(function(containerBuilder,config){this._={containerBuilder:containerBuilder,config:config}},{load:function(){},setup:function(){},_getConfig:function(defaults){return defaults&&(this._.config=Arrays.mergeTree({},defaults,this._.config)),this._.config},_getContainerBuilder:function(){return this._.containerBuilder}});_context.register(BuilderExtension,"BuilderExtension")},{Arrays:"Utils.Arrays"}),_context.invoke("Nittro.DI",function(Container,BuilderExtension,undefined){var ContainerBuilder=_context.extend(Container,function(config){config||(config={}),ContainerBuilder.Super.call(this,config),this._.extensions=config.extensions||{}},{addExtension:function(name,extension){if(this._.extensions[name]!==undefined)throw new Error('Container builder already has an extension called "'+name+'"');return this._.extensions[name]=extension,this},createContainer:function(){return this._prepareExtensions(),this._loadExtensions(),this._setupExtensions(),new Container({params:this._.params,services:this._.serviceDefs,factories:this._.factories})},_prepareExtensions:function(){var name,extension;for(name in this._.extensions){if("function"==typeof(extension=this._.extensions[name])?extension=this.invoke(extension,{containerBuilder:this,config:this._.params[name]||{}}):"string"==typeof extension&&(extension=this._expandEntity(this._toEntity(extension),null,{containerBuilder:this,config:this._.params[name]||{}})),!(extension instanceof BuilderExtension))throw new Error('Extension "'+name+'" is not an instance of Nittro.DI.BuilderExtension');this._.extensions[name]=extension}},_loadExtensions:function(){for(var name in this._.extensions)this._.extensions[name].load()},_setupExtensions:function(){for(var name in this._.extensions)this._.extensions[name].setup()}});_context.register(ContainerBuilder,"ContainerBuilder")}),_context.invoke("Nittro.Ajax",function(Nittro,Url,undefined){var Request=_context.extend("Nittro.Object",function(url,method,data){this._={url:Url.from(url),method:(method||"GET").toUpperCase(),data:data||{},headers:{},normalized:!1,dispatched:!1,deferred:{fulfill:null,reject:null,promise:null},abort:null,aborted:!1,response:null},this._.deferred.promise=new Promise(function(fulfill,reject){this._.deferred.fulfill=fulfill,this._.deferred.reject=reject}.bind(this))},{getUrl:function(){return this._normalize(),this._.url},getMethod:function(){return this._.method},isGet:function(){return"GET"===this._.method},isPost:function(){return"POST"===this._.method},isMethod:function(method){return method.toUpperCase()===this._.method},getData:function(){return this._normalize(),this._.data},getHeaders:function(){return this._.headers},setUrl:function(url){return this._updating("url"),this._.url=Url.from(url),this},setMethod:function(method){return this._updating("method"),this._.method=method.toLowerCase(),this},setData:function(k,v){if(this._updating("data"),null===k)this._.data={};else if(v===undefined&&"object"==typeof k)for(v in k)k.hasOwnProperty(v)&&(this._.data[v]=k[v]);else this._.data[k]=v;return this},setHeader:function(header,value){return this._updating("headers"),this._.headers[header]=value,this},setHeaders:function(headers){for(var header in this._updating("headers"),headers)headers.hasOwnProperty(header)&&(this._.headers[header]=headers[header]);return this},setDispatched:function(abort){if(this._.dispatched)throw new Error("Request has already been dispatched");if("function"!=typeof abort)throw new Error('"abort" must be a function');return this._.dispatched=!0,this._.abort=abort,this},isDispatched:function(){return this._.dispatched},setFulfilled:function(response){return response&&this.setResponse(response),this._.deferred.fulfill(this.getResponse()),this},setRejected:function(reason){return this._.deferred.reject(reason),this},then:function(onfulfilled,onrejected){return this._.deferred.promise.then(onfulfilled,onrejected)},abort:function(){return this._.abort&&!this._.aborted&&this._.abort(),this._.aborted=!0,this},isAborted:function(){return this._.aborted},setResponse:function(response){return this._.response=response,this},getResponse:function(){return this._.response},_normalize:function(){!this._.normalized&&this.isFrozen()&&(this._.normalized=!0,"GET"!==this._.method&&"HEAD"!==this._.method||(this._.url.addParams(Nittro.Forms&&Nittro.Forms.FormData&&this._.data instanceof Nittro.Forms.FormData?this._.data.exportData(!0):this._.data),this._.data={}))}});_context.mixin(Request,"Nittro.Freezable"),_context.register(Request,"Request")},{Url:"Utils.Url"}),_context.invoke("Nittro.Ajax",function(){var Response=_context.extend(function(status,payload,headers){this._={status:status,payload:payload,headers:headers}},{getStatus:function(){return this._.status},getPayload:function(){return this._.payload},getHeader:function(name){return this._.headers[name.toLowerCase()]},getAllHeaders:function(){return this._.headers}});_context.register(Response,"Response")}),_context.invoke("Nittro.Ajax",function(Request,Arrays,Url){var Service=_context.extend("Nittro.Object",function(options){Service.Super.call(this),this._.options=Arrays.mergeTree({},Service.defaults,options),this._.transport=null,this._.options.allowOrigins?Array.isArray(this._.options.allowOrigins)||(this._.options.allowOrigins=this._.options.allowOrigins.split(/\s*,\s*/g)):this._.options.allowOrigins=[],this._.options.allowOrigins.push(Url.fromCurrent().getOrigin())},{STATIC:{defaults:{allowOrigins:null}},setTransport:function(transport){return this._.transport=transport,this},addTransport:function(transport){return console.log("The Nittro.Ajax.Service.addTransport() method is deprecated, please use setTransport instead"),this.setTransport(transport)},supports:function(url,method,data){return this._.transport.supports(url,method,data)},isAllowedOrigin:function(url){return-1<this._.options.allowOrigins.indexOf(Url.from(url).getOrigin())},get:function(url,data){return this.dispatch(this.createRequest(url,"get",data))},post:function(url,data){return this.dispatch(this.createRequest(url,"post",data))},createRequest:function(url,method,data){if(!this.isAllowedOrigin(url))throw new Error('The origin of the URL "'+url+'" is not in the list of allowed origins');if(!this.supports(url,method,data))throw new Error("The request with the specified URL, method and data isn't supported by the AJAX transport");var request=new Request(url,method,data);return this.trigger("request-created",{request:request}),request},dispatch:function(request){return request.freeze(),this._.transport.dispatch(request)}});_context.register(Service,"Service")},{Arrays:"Utils.Arrays",Url:"Utils.Url"}),_context.invoke("Nittro.Ajax.Transport",function(Nittro,Response,Url){var Native=_context.extend(function(){},{STATIC:{createXhr:function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}},supports:function(url,method,data){return!(data&&Nittro.Forms&&data instanceof Nittro.Forms.FormData&&data.isUpload()&&!window.FormData)&&!(!(window.XMLHttpRequest&&"withCredentials"in XMLHttpRequest.prototype)&&Url.fromCurrent().compare(url)>=Url.PART.PORT)},dispatch:function(request){var xhr=Native.createXhr(),adv=this._checkSupport(request,xhr),abort=xhr.abort.bind(xhr);if(request.isAborted())return request.setRejected(this._createError(request,xhr,{type:"abort"})),request;this._bindEvents(request,xhr,adv),xhr.open(request.getMethod(),request.getUrl().toAbsolute(),!0);var data=this._formatData(request,xhr);return this._addHeaders(request,xhr),xhr.send(data),request.setDispatched(abort),request},_checkSupport:function(request,xhr){var adv;if(!((adv="addEventListener"in xhr)||"onreadystatechange"in xhr))throw new Error("Unsupported XHR implementation");return adv},_bindEvents:function(request,xhr,adv){var self=this,done=!1;function onLoad(evt){done||(done=!0,200<=xhr.status&&xhr.status<300?request.setFulfilled(self._createResponse(xhr)):request.setRejected(self._createError(request,xhr,evt)))}function onError(evt){done||(done=!0,request.setRejected(self._createError(request,xhr,evt)))}adv?(xhr.addEventListener("load",onLoad,!1),xhr.addEventListener("error",onError,!1),xhr.addEventListener("abort",onError,!1),"upload"in xhr&&xhr.upload.addEventListener("progress",function(evt){request.trigger("progress",{lengthComputable:evt.lengthComputable,loaded:evt.loaded,total:evt.total})},!1)):(xhr.onreadystatechange=function(){4===xhr.readyState&&(200<=xhr.status&&xhr.status<300?onLoad():onError())},"ontimeout"in xhr&&(xhr.ontimeout=onError),"onerror"in xhr&&(xhr.onerror=onError),"onload"in xhr&&(xhr.onload=onLoad))},_addHeaders:function(request,xhr){var h,headers=request.getHeaders();for(h in headers)headers.hasOwnProperty(h)&&xhr.setRequestHeader(h,headers[h]);headers.hasOwnProperty("X-Requested-With")||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest")},_formatData:function(request,xhr){var data=request.getData();return Nittro.Forms&&data instanceof Nittro.Forms.FormData?(data=data.exportData(request.isGet()||request.isMethod("HEAD")),window.FormData&&data instanceof window.FormData||(data=Url.buildQuery(data,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"))):(data=Url.buildQuery(data),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),data},_createResponse:function(xhr){var payload,headers={};return(xhr.getAllResponseHeaders()||"").trim().split(/\r\n/g).forEach(function(header){header&&!header.match(/^\s*$/)&&(header=header.match(/^\s*([^:]+):\s*(.+?)\s*$/),headers[header[1].toLowerCase()]=header[2])}),payload=headers["content-type"]&&"application/json"===headers["content-type"].split(/;/)[0]?JSON.parse(xhr.responseText||"{}"):xhr.responseText,new Response(xhr.status,payload,headers)},_createError:function(request,xhr,evt){return 4===xhr.readyState&&0!==xhr.status&&request.setResponse(this._createResponse(xhr)),evt&&"abort"===evt.type?{type:"abort",status:null,request:request}:0===xhr.status?{type:"connection",status:null,request:request}:xhr.status<200||300<=xhr.status?{type:"response",status:xhr.status,request:request}:{type:"unknown",status:xhr.status,request:request}}});_context.register(Native,"Native")},{Url:"Utils.Url",Response:"Nittro.Ajax.Response"}),function(global,factory){if(global.JSON)if("function"==typeof define&&define.amd)define(function(){return factory(global)});else if("object"==typeof module&&"object"==typeof module.exports)module.exports=factory(global);else{var init=!global.Nette||!global.Nette.noInit;global.Nette=factory(global),init&&global.Nette.initOnLoad()}}("undefined"!=typeof window?window:this,function(window){"use strict";var Nette={};function getHandler(callback){return function(e){return callback.call(this,e)}}Nette.formErrors=[],Nette.version="2.4",Nette.addEvent=function(element,on,callback){"DOMContentLoaded"===on&&"loading"!==element.readyState?callback.call(this):element.addEventListener?element.addEventListener(on,callback):"DOMContentLoaded"===on?element.attachEvent("onreadystatechange",function(){"complete"===element.readyState&&callback.call(this)}):element.attachEvent("on"+on,getHandler(callback))},Nette.getValue=function(elem){var i;if(elem){if(elem.tagName){if("radio"===elem.type){var elements=elem.form.elements;for(i=0;i<elements.length;i++)if(elements[i].name===elem.name&&elements[i].checked)return elements[i].value;return null}if("file"===elem.type)return elem.files||elem.value;if("select"===elem.tagName.toLowerCase()){var index=elem.selectedIndex,options=elem.options,values=[];if("select-one"===elem.type)return index<0?null:options[index].value;for(i=0;i<options.length;i++)options[i].selected&&values.push(options[i].value);return values}if(elem.name&&elem.name.match(/\[\]$/)){for(elements=elem.form.elements[elem.name].tagName?[elem]:elem.form.elements[elem.name],values=[],i=0;i<elements.length;i++)("checkbox"!==elements[i].type||elements[i].checked)&&values.push(elements[i].value);return values}return"checkbox"===elem.type?elem.checked:"textarea"===elem.tagName.toLowerCase()?elem.value.replace("\r",""):elem.value.replace("\r","").replace(/^\s+|\s+$/g,"")}return elem[0]?Nette.getValue(elem[0]):null}return null},Nette.getEffectiveValue=function(elem){var val=Nette.getValue(elem);return elem.getAttribute&&val===elem.getAttribute("data-nette-empty-value")&&(val=""),val},Nette.validateControl=function(elem,rules,onlyCheck,value,emptyOptional){elem=elem.tagName?elem:elem[0],rules=rules||Nette.parseJSON(elem.getAttribute("data-nette-rules")),value=void 0===value?{value:Nette.getEffectiveValue(elem)}:value;for(var id=0,len=rules.length;id<len;id++){var rule=rules[id],op=rule.op.match(/(~)?([^?]+)/),curElem=rule.control?elem.form.elements.namedItem(rule.control):elem;if(rule.neg=op[1],rule.op=op[2],rule.condition=!!rule.rules,curElem)if("optional"!==rule.op){if(!emptyOptional||rule.condition||":filled"===rule.op){curElem=curElem.tagName?curElem:curElem[0];var curValue=elem===curElem?value:{value:Nette.getEffectiveValue(curElem)},success=Nette.validateRule(curElem,rule.op,rule.arg,curValue);if(null!==success)if(rule.neg&&(success=!success),rule.condition&&success){if(!Nette.validateControl(elem,rule.rules,onlyCheck,value,":blank"!==rule.op&&emptyOptional))return!1}else if(!rule.condition&&!success){if(Nette.isDisabled(curElem))continue;if(!onlyCheck){var arr=Nette.isArray(rule.arg)?rule.arg:[rule.arg],message=rule.msg.replace(/%(value|\d+)/g,function(foo,m){return Nette.getValue("value"===m?curElem:elem.form.elements.namedItem(arr[m].control))});Nette.addError(curElem,message)}return!1}}}else emptyOptional=!Nette.validateRule(elem,":filled",null,value)}return!("number"===elem.type&&!elem.validity.valid)||(onlyCheck||Nette.addError(elem,"Please enter a valid value."),!1)},Nette.validateForm=function(sender,onlyCheck){var form=sender.form||sender,scope=!1;if(Nette.formErrors=[],form["nette-submittedBy"]&&null!==form["nette-submittedBy"].getAttribute("formnovalidate")){var scopeArr=Nette.parseJSON(form["nette-submittedBy"].getAttribute("data-nette-validation-scope"));if(!scopeArr.length)return Nette.showFormErrors(form,[]),!0;scope=new RegExp("^("+scopeArr.join("-|")+"-)")}var i,elem,radios={};for(i=0;i<form.elements.length;i++)if(!(elem=form.elements[i]).tagName||elem.tagName.toLowerCase()in{input:1,select:1,textarea:1,button:1}){if("radio"===elem.type){if(radios[elem.name])continue;radios[elem.name]=!0}if(!(scope&&!elem.name.replace(/]\[|\[|]|$/g,"-").match(scope)||Nette.isDisabled(elem)||Nette.validateControl(elem,null,onlyCheck)||Nette.formErrors.length))return!1}var success=!Nette.formErrors.length;return Nette.showFormErrors(form,Nette.formErrors),success},Nette.isDisabled=function(elem){if("radio"!==elem.type)return elem.disabled;for(var i=0,elements=elem.form.elements;i<elements.length;i++)if(elements[i].name===elem.name&&!elements[i].disabled)return!1;return!0},Nette.addError=function(elem,message){Nette.formErrors.push({element:elem,message:message})},Nette.showFormErrors=function(form,errors){for(var focusElem,messages=[],i=0;i<errors.length;i++){var elem=errors[i].element,message=errors[i].message;Nette.inArray(messages,message)||(messages.push(message),!focusElem&&elem.focus&&(focusElem=elem))}messages.length&&(alert(messages.join("\n")),focusElem&&focusElem.focus())},Nette.expandRuleArgument=function(form,arg){if(arg&&arg.control){var control=form.elements.namedItem(arg.control),value={value:Nette.getEffectiveValue(control)};Nette.validateControl(control,null,!0,value),arg=value.value}return arg};var preventFiltering=!1;return Nette.validateRule=function(elem,op,arg,value){value=void 0===value?{value:Nette.getEffectiveValue(elem)}:value,":"===op.charAt(0)&&(op=op.substr(1)),op=(op=op.replace("::","_")).replace(/\\/g,"");var arr=Nette.isArray(arg)?arg.slice(0):[arg];if(!preventFiltering){preventFiltering=!0;for(var i=0,len=arr.length;i<len;i++)arr[i]=Nette.expandRuleArgument(elem.form,arr[i]);preventFiltering=!1}return Nette.validators[op]?Nette.validators[op](elem,Nette.isArray(arg)?arr:arr[0],value.value,value):null},Nette.validators={filled:function(elem,arg,val){return!("number"!==elem.type||!elem.validity.badInput)||""!==val&&!1!==val&&null!==val&&(!Nette.isArray(val)||!!val.length)&&(!window.FileList||!(val instanceof window.FileList)||val.length)},blank:function(elem,arg,val){return!Nette.validators.filled(elem,arg,val)},valid:function(elem){return Nette.validateControl(elem,null,!0)},equal:function(elem,arg,val){if(void 0===arg)return null;function toString(val){return"number"==typeof val||"string"==typeof val?""+val:!0===val?"1":""}val=Nette.isArray(val)?val:[val],arg=Nette.isArray(arg)?arg:[arg];loop:for(var i1=0,len1=val.length;i1<len1;i1++){for(var i2=0,len2=arg.length;i2<len2;i2++)if(toString(val[i1])===toString(arg[i2]))continue loop;return!1}return!0},notEqual:function(elem,arg,val){return void 0===arg?null:!Nette.validators.equal(elem,arg,val)},minLength:function(elem,arg,val){if("number"===elem.type){if(elem.validity.tooShort)return!1;if(elem.validity.badInput)return null}return val.length>=arg},maxLength:function(elem,arg,val){if("number"===elem.type){if(elem.validity.tooLong)return!1;if(elem.validity.badInput)return null}return val.length<=arg},length:function(elem,arg,val){if("number"===elem.type){if(elem.validity.tooShort||elem.validity.tooLong)return!1;if(elem.validity.badInput)return null}return(null===(arg=Nette.isArray(arg)?arg:[arg,arg])[0]||val.length>=arg[0])&&(null===arg[1]||val.length<=arg[1])},email:function(elem,arg,val){return/^("([ !#-[\]-~]|\\[ -~])+"|[-a-z0-9!#$%&'*+/=?^_`{|}~]+(\.[-a-z0-9!#$%&'*+/=?^_`{|}~]+)*)@([0-9a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,61}[0-9a-z\u00C0-\u02FF\u0370-\u1EFF])?\.)+[a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,17}[a-z\u00C0-\u02FF\u0370-\u1EFF])?$/i.test(val)},url:function(elem,arg,val,value){return/^[a-z\d+.-]+:/.test(val)||(val="http://"+val),!!/^https?:\/\/((([-_0-9a-z\u00C0-\u02FF\u0370-\u1EFF]+\.)*[0-9a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,61}[0-9a-z\u00C0-\u02FF\u0370-\u1EFF])?\.)?[a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,17}[a-z\u00C0-\u02FF\u0370-\u1EFF])?|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|\[[0-9a-f:]{3,39}\])(:\d{1,5})?(\/\S*)?$/i.test(val)&&(value.value=val,!0)},regexp:function(elem,arg,val){var parts="string"==typeof arg&&arg.match(/^\/(.*)\/([imu]*)$/);try{return parts&&new RegExp(parts[1],parts[2].replace("u","")).test(val)}catch(e){}},pattern:function(elem,arg,val,value,caseInsensitive){if("string"!=typeof arg)return null;try{try{var regExp=new RegExp("^(?:"+arg+")$",caseInsensitive?"ui":"u")}catch(e){regExp=new RegExp("^(?:"+arg+")$",caseInsensitive?"i":"")}if(window.FileList&&val instanceof FileList){for(var i=0;i<val.length;i++)if(!regExp.test(val[i].name))return!1;return!0}return regExp.test(val)}catch(e){}},patternCaseInsensitive:function(elem,arg,val){return Nette.validators.pattern(elem,arg,val,null,!0)},integer:function(elem,arg,val){return("number"!==elem.type||!elem.validity.badInput)&&/^-?[0-9]+$/.test(val)},float:function(elem,arg,val,value){return("number"!==elem.type||!elem.validity.badInput)&&(val=val.replace(/ +/g,"").replace(/,/g,"."),!!/^-?[0-9]*\.?[0-9]+$/.test(val)&&(value.value=val,!0))},min:function(elem,arg,val){if("number"===elem.type){if(elem.validity.rangeUnderflow)return!1;if(elem.validity.badInput)return null}return null===arg||parseFloat(val)>=arg},max:function(elem,arg,val){if("number"===elem.type){if(elem.validity.rangeOverflow)return!1;if(elem.validity.badInput)return null}return null===arg||parseFloat(val)<=arg},range:function(elem,arg,val){if("number"===elem.type){if(elem.validity.rangeUnderflow||elem.validity.rangeOverflow)return!1;if(elem.validity.badInput)return null}return Nette.isArray(arg)?(null===arg[0]||parseFloat(val)>=arg[0])&&(null===arg[1]||parseFloat(val)<=arg[1]):null},submitted:function(elem){return elem.form["nette-submittedBy"]===elem},fileSize:function(elem,arg,val){if(window.FileList)for(var i=0;i<val.length;i++)if(val[i].size>arg)return!1;return!0},image:function(elem,arg,val){if(window.FileList&&val instanceof window.FileList)for(var i=0;i<val.length;i++){var type=val[i].type;if(type&&"image/gif"!==type&&"image/png"!==type&&"image/jpeg"!==type)return!1}return!0},static:function(elem,arg){return arg}},Nette.toggleForm=function(form,elem){var i;for(Nette.toggles={},i=0;i<form.elements.length;i++)form.elements[i].tagName.toLowerCase()in{input:1,select:1,textarea:1,button:1}&&Nette.toggleControl(form.elements[i],null,null,!elem);for(i in Nette.toggles)Nette.toggle(i,Nette.toggles[i],elem)},Nette.toggleControl=function(elem,rules,success,firsttime,value){rules=rules||Nette.parseJSON(elem.getAttribute("data-nette-rules")),value=void 0===value?{value:Nette.getEffectiveValue(elem)}:value;for(var curSuccess,has=!1,handled=[],handler=function(){Nette.toggleForm(elem.form,elem)},id=0,len=rules.length;id<len;id++){var rule=rules[id],op=rule.op.match(/(~)?([^?]+)/),curElem=rule.control?elem.form.elements.namedItem(rule.control):elem;if(curElem){if(!1!==(curSuccess=success)){rule.neg=op[1],rule.op=op[2];var curValue=elem===curElem?value:{value:Nette.getEffectiveValue(curElem)};if(null===(curSuccess=Nette.validateRule(curElem,rule.op,rule.arg,curValue)))continue;rule.neg&&(curSuccess=!curSuccess),rule.rules||(success=curSuccess)}if(rule.rules&&Nette.toggleControl(elem,rule.rules,curSuccess,firsttime,value)||rule.toggle){if(has=!0,firsttime)for(var oldIE=!document.addEventListener,name=curElem.tagName?curElem.name:curElem[0].name,els=curElem.tagName?curElem.form.elements:curElem,i=0;i<els.length;i++)els[i].name!==name||Nette.inArray(handled,els[i])||(Nette.addEvent(els[i],oldIE&&els[i].type in{checkbox:1,radio:1}?"click":"change",handler),handled.push(els[i]));for(var id2 in rule.toggle||[])Object.prototype.hasOwnProperty.call(rule.toggle,id2)&&(Nette.toggles[id2]=Nette.toggles[id2]||(rule.toggle[id2]?curSuccess:!curSuccess))}}}return has},Nette.parseJSON=function(s){return"{op"===(s||"").substr(0,3)?eval("["+s+"]"):JSON.parse(s||"[]")},Nette.toggle=function(id,visible,srcElement){var elem=document.getElementById(id);elem&&(elem.style.display=visible?"":"none")},Nette.initForm=function(form){Nette.toggleForm(form),form.noValidate||(form.noValidate=!0,Nette.addEvent(form,"submit",function(e){Nette.validateForm(form)||(e&&e.stopPropagation?(e.stopPropagation(),e.preventDefault()):window.event&&(event.cancelBubble=!0,event.returnValue=!1))}))},Nette.initOnLoad=function(){Nette.addEvent(document,"DOMContentLoaded",function(){for(var i=0;i<document.forms.length;i++)for(var form=document.forms[i],j=0;j<form.elements.length;j++)if(form.elements[j].getAttribute("data-nette-rules")){Nette.initForm(form);break}Nette.addEvent(document.body,"click",function(e){for(var target=e.target||e.srcElement;target;){if(target.form&&target.type in{submit:1,image:1}){target.form["nette-submittedBy"]=target;break}target=target.parentNode}})})},Nette.isArray=function(arg){return"[object Array]"===Object.prototype.toString.call(arg)},Nette.inArray=function(arr,val){if([].indexOf)return-1<arr.indexOf(val);for(var i=0;i<arr.length;i++)if(arr[i]===val)return!0;return!1},Nette.webalize=function(s){s=s.toLowerCase();var i,res="";for(i=0;i<s.length;i++)res+=Nette.webalizeTable[s.charAt(i)]||s.charAt(i);return res.replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")},Nette.webalizeTable={"á":"a","ä":"a","č":"c","ď":"d","é":"e","ě":"e","í":"i","ľ":"l","ň":"n","ó":"o","ô":"o","ř":"r","š":"s","ť":"t","ú":"u","ů":"u","ý":"y","ž":"z"},Nette}),_context.invoke("Nittro.Forms",function(){var Nette;if(!(Nette="object"==typeof module&&"object"==typeof module.exports?require("nette-forms"):window.Nette)||!Nette.validators)throw new Error("netteForms.js asset from Nette/Forms has not been loaded");_context.register(Nette,"Vendor")}),_context.invoke("Nittro.Forms",function(undefined){var FormData=_context.extend(function(){this._={dataStorage:[],upload:!1}},{append:function(name,value){if(value===undefined||null===value)return this;if(this._isFile(value))this._.upload=!0;else{if("object"==typeof value&&"valueOf"in value&&/string|number|boolean/.test(typeof value.valueOf())&&!arguments[2])return this.append(name,value.valueOf(),!0);if(!/string|number|boolean/.test(typeof value))throw new Error("Only scalar values and File/Blob objects can be appended to FormData, "+typeof value+" given")}return this._.dataStorage.push({name:name,value:value}),this},isUpload:function(){return this._.upload},_isFile:function(value){return window.File!==undefined&&value instanceof window.File||window.Blob!==undefined&&value instanceof window.Blob},mergeData:function(data){for(var i=0;i<data.length;i++)this.append(data[i].name,data[i].value);return this},exportData:function(forcePlain){if(forcePlain||!this.isUpload()||window.FormData===undefined)return this._.dataStorage.filter(function(e){return!this._isFile(e.value)},this);var i,fd=new window.FormData;for(i=0;i<this._.dataStorage.length;i++)"boolean"==typeof this._.dataStorage[i].value?fd.append(this._.dataStorage[i].name,this._.dataStorage[i].value?1:0):fd.append(this._.dataStorage[i].name,this._.dataStorage[i].value);return fd}});_context.register(FormData,"FormData")}),_context.invoke("Nittro.Forms",function(DOM,Arrays,DateTime,FormData,Vendor,undefined){var FileList=window.FileList||function(){},Form=_context.extend("Nittro.Object",function(form){Form.Super.call(this),this._.submittedBy=null,this._.inLiveValidation=!1,this._.errorRenderer=null,this._handleSubmit=this._handleSubmit.bind(this),this._handleReset=this._handleReset.bind(this),this.setElement(form),this.on("error:default",this._handleError.bind(this)),this.on("blur:default",this._handleBlur.bind(this))},{setErrorRenderer:function(renderer){this._.errorRenderer=renderer},setElement:function(form){if("string"==typeof form&&(form=DOM.getById(form)),!(form&&form instanceof HTMLFormElement))throw new TypeError("Invalid argument, must be a HTMLFormElement");return this._.form=form,this._.form.noValidate="novalidate",this._.validationMode=DOM.getData(form,"validation-mode"),this._.submittedBy&&(this._.form["nette-submittedBy"]=this.getElement(this._.submittedBy)),DOM.addListener(this._.form,"submit",this._handleSubmit),DOM.addListener(this._.form,"reset",this._handleReset),this},getElement:function(name){return name?this._.form.elements.namedItem(name):this._.form},getElements:function(){return this._.form.elements},setSubmittedBy:function(value){return value?(this._.submittedBy=value,this._.form["nette-submittedBy"]=this.getElement(value)):this._.submittedBy=this._.form["nette-submittedBy"]=null,this},validate:function(sender){return this._.errorRenderer&&this._.errorRenderer.cleanupErrors(this._.form),!!Vendor.validateForm(sender||this._.form)&&!this.trigger("validate",{sender:sender}).isDefaultPrevented()},setValues:function(values,reset){var name,value,i,names=this._getFieldNames();for(values||(values={}),i=0;i<names.length;i++){if(name=names[i],value=undefined,-1<name.indexOf("[")?(value=values,name.replace(/]/g,"").split(/\[/g).some(function(key){return""===key||(key in value?(value=value[key],!1):(value=undefined,!0))})):name in values&&(value=values[name]),value===undefined){if(!reset)continue;value=null}this.setValue(name,value)}},setValue:function(elem,value){"string"==typeof elem&&(elem=this._.form.elements.namedItem(elem));var i,toStr=function(v){return""+v};if(!elem)throw new TypeError("Invalid argument to setValue(), must be (the name of) an existing form element");if(elem.tagName)if("radio"===elem.type)elem.checked=null!==value&&elem.value===toStr(value);else if("file"===elem.type)null===value&&(value=elem.parentNode.innerHTML,DOM.html(elem.parentNode,value));else if("select"===elem.tagName.toLowerCase()){var v,single="select-one"===elem.type,arr=Array.isArray(value);for(value=arr?value.map(toStr):toStr(value),i=0;i<elem.options.length&&(v=arr?-1<value.indexOf(elem.options.item(i).value):value===elem.options.item(i).value,!(elem.options.item(i).selected=v)||!single);i++);}else"checkbox"===elem.type?elem.checked=Array.isArray(value)?-1<value.map(toStr).indexOf(elem.value):!!value:"date"===elem.type?elem.value=value?DateTime.from(value).format("Y-m-d"):"":"datetime-local"===elem.type||"datetime"===elem.type?elem.value=value?DateTime.from(value).format("Y-m-d\\TH:i:s"):"":elem.value=null!==value?toStr(value):"";else if("length"in elem)for(i=0;i<elem.length;i++)this.setValue(elem[i],value);return this},getValue:function(name){return Vendor.getEffectiveValue(this.getElement(name))},serialize:function(){var elem,i,value,data=new FormData,names=this._getFieldNames(!0);for(this._.submittedBy&&names.push(this._.submittedBy),i=0;i<names.length;i++)if(elem=this._.form.elements.namedItem(names[i]),value=Vendor.getEffectiveValue(elem),Array.isArray(value)||value instanceof FileList)for(var j=0;j<value.length;j++)data.append(names[i],value[j]);else data.append(names[i],value);return this.trigger("serialize",data),data},submit:function(by){if(by){var btn=this._.form.elements.namedItem(by);if(!btn||"submit"!==btn.type)throw new TypeError("Unknown element or not a submit button: "+by);DOM.trigger(btn,"click")}else DOM.trigger(this._.form,"submit");return this},reset:function(){return this._.form.reset(),this},destroy:function(){this.trigger("destroy"),this.off(),DOM.removeListener(this._.form,"submit",this._handleSubmit),DOM.removeListener(this._.form,"reset",this._handleReset),this._.form=null},_handleSubmit:function(evt){if(this.trigger("submit").isDefaultPrevented())evt.preventDefault();else{var sender=this._.submittedBy?this.getElement(this._.submittedBy):null;this.validate(sender)||evt.preventDefault()}},_handleReset:function(evt){if(evt.target===this._.form){var elem,i;for(i=0;i<this._.form.elements.length;i++)"hidden"===(elem=this._.form.elements.item(i)).type&&elem.hasAttribute("data-default-value")?this.setValue(elem,DOM.getData(elem,"default-value")):"file"===elem.type&&this.setValue(elem,null);this._.submittedBy=this._.form["nette-submittedBy"]=null,this.trigger("reset")}},_handleError:function(evt){this._.errorRenderer&&this._.errorRenderer.addError(this._.form,evt.data.element,evt.data.message),!this._.inLiveValidation&&evt.data.element&&"function"==typeof evt.data.element.focus&&evt.data.element.focus()},_handleBlur:function(evt){this._.errorRenderer&&this._.errorRenderer.cleanupErrors(this._.form,evt.data.element),"live"===DOM.getData(evt.data.element,"validation-mode",this._.validationMode)&&(this._.inLiveValidation=!0,Vendor.validateControl(evt.data.element),this._.inLiveValidation=!1)},_getFieldNames:function(enabledOnly){var elem,i,names=[];for(i=0;i<this._.form.elements.length;i++)!(elem=this._.form.elements.item(i)).name||enabledOnly&&elem.disabled||-1!==names.indexOf(elem.name)||elem.type in{submit:1,button:1,reset:1}||names.push(elem.name);return names}});_context.register(Form,"Form")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",DateTime:"Utils.DateTime"}),_context.invoke("Nittro.Forms",function(Form,Vendor,DOM,Arrays){var anonId=0,Locator=_context.extend("Nittro.Object",function(formErrorRenderer){this._={errorRenderer:formErrorRenderer||null,registry:{}},Vendor.addError=this._forwardError.bind(this),DOM.addListener(document,"blur",this._handleBlur.bind(this),!0)},{getForm:function(id){var elem;return"string"!=typeof id&&((elem=id).getAttribute("id")||elem.setAttribute("id","frm-anonymous"+ ++anonId),id=elem.getAttribute("id")),id in this._.registry||(this._.registry[id]=new Form(elem||id),this._.registry[id].setErrorRenderer(this._.errorRenderer),this.trigger("form-added",{form:this._.registry[id]})),this._.registry[id]},removeForm:function(id){"string"!=typeof id&&(id=id.getAttribute("id")),id in this._.registry&&(this.trigger("form-removed",{form:this._.registry[id]}),this._.registry[id].destroy(),delete this._.registry[id])},refreshForms:function(){var elem,id;for(id in this._.registry)this._.registry.hasOwnProperty(id)&&((elem=DOM.getById(id))?elem!==this._.registry[id].getElement()&&this._.registry[id].setElement(elem):this.removeForm(id));Arrays.createFrom(document.getElementsByTagName("form")).forEach(this.getForm.bind(this))},_forwardError:function(elem,msg){this.getForm(elem.form).trigger("error",{element:elem,message:msg})},_handleBlur:function(evt){evt.target.form&&evt.target.form instanceof HTMLFormElement&&this.getForm(evt.target.form).trigger("blur",{element:evt.target})}});_context.register(Locator,"Locator")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"}),_context.invoke("Nittro.Forms",function(DOM){var DefaultErrorRenderer=_context.extend(function(){},{addError:function(form,element,message){var elem,container=this._getErrorContainer(form,element);container&&((elem=element&&element.parentNode===container?DOM.create("span",{class:"error"}):DOM.create(container.tagName.match(/^(ul|ol)$/i)?"li":"p",{class:"error"})).textContent=message,container.appendChild(elem))},cleanupErrors:function(form,element){var container=element?this._getErrorContainer(form,element):form;container&&DOM.getByClassName("error",container).forEach(function(elem){elem.parentNode.removeChild(elem)})},_getErrorContainer:function(form,elem){return(elem&&elem.id?DOM.getById(elem.id+"-errors"):null)||DOM.getById(form.id+"-errors")||(elem?elem.parentNode:null)}});_context.register(DefaultErrorRenderer,"DefaultErrorRenderer")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(DOM,undefined){var Snippet=_context.extend(function(id,phase){this._={id:id,container:!1,phase:"number"==typeof phase?phase:Snippet.INACTIVE,data:{},handlers:[[],[],[],[]]}},{STATIC:{INACTIVE:-1,PREPARE_SETUP:0,RUN_SETUP:1,PREPARE_TEARDOWN:2,RUN_TEARDOWN:3},getId:function(){return this._.id},setup:function(prepare,run){return prepare&&!run&&(run=prepare,prepare=null),prepare&&(this._.phase===Snippet.PREPARE_SETUP?prepare(this.getElement()):this._.handlers[Snippet.PREPARE_SETUP].push(prepare)),run&&(this._.phase===Snippet.RUN_SETUP?run(this.getElement()):this._.handlers[Snippet.RUN_SETUP].push(run)),this},teardown:function(prepare,run){return prepare&&!run&&(run=prepare,prepare=null),prepare&&(this._.phase===Snippet.PREPARE_TEARDOWN?prepare(this.getElement()):this._.handlers[Snippet.PREPARE_TEARDOWN].push(prepare)),run&&(this._.phase===Snippet.RUN_TEARDOWN?run(this.getElement()):this._.handlers[Snippet.RUN_TEARDOWN].push(run)),this},runPhase:function(phase){if(phase===Snippet.INACTIVE)this._.phase=phase,this._.handlers.forEach(function(queue){queue.splice(0,queue.length)});else if(phase-1===this._.phase){this._.phase=phase;var elm=this.getElement();this._.handlers[this._.phase].forEach(function(handler){handler(elm)}),this._.handlers[this._.phase].splice(0,this._.handlers[this._.phase].length)}return this},getPhase:function(){return this._.phase},getData:function(key,def){return key in this._.data?this._.data[key]:def===undefined?null:def},setData:function(key,value){return this._.data[key]=value,this},setContainer:function(){return this._.container=!0,this},isContainer:function(){return this._.container},getElement:function(){return DOM.getById(this._.id)}});_context.register(Snippet,"Snippet")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(DOM){var Helpers={buildContent:function(elem,html){return(elem=elem.split(/\./g))[0]=DOM.create(elem[0]),1<elem.length&&DOM.addClass.apply(DOM,elem),elem=elem[0],DOM.html(elem,html),elem},prepareDynamicContainer:function(snippet){var elem=snippet.getElement(),params={id:snippet.getId(),mask:new RegExp("^"+DOM.getData(elem,"dynamic-mask")+"$"),element:DOM.getData(elem,"dynamic-element")||"div",sort:DOM.getData(elem,"dynamic-sort")||"append",sortCache:!1!==DOM.getData(elem,"dynamic-sort-cache")&&null};return snippet.setContainer(),snippet.setData("_snippet_container",params),params},computeSortedSnippets:function(container,snippets,changeset){var sortData=Helpers._getSortData(container.getData("_snippet_container"),container.getElement(),changeset);return Helpers._mergeSortData(sortData,snippets),Helpers._applySortData(sortData)},applySortedSnippets:function(container,ids,snippets){var tmp,i=0,n=ids.length;for(tmp=container.firstElementChild;i<n&&ids[i]in snippets&&!snippets[ids[i]].element;)container.insertBefore(snippets[ids[i]].content,tmp),i++;for(;i<n&&ids[n-1]in snippets&&!snippets[ids[n-1]].element;)n--;for(;i<n;i++)ids[i]in snippets&&(snippets[ids[i]].element?snippets[ids[i]].element.previousElementSibling!==(0<i?DOM.getById(ids[i-1]):null)&&container.insertBefore(snippets[ids[i]].element,0<i?DOM.getById(ids[i-1]).nextElementSibling:container.firstElementChild):container.insertBefore(snippets[ids[i]].content,DOM.getById(ids[i-1]).nextElementSibling));for(;n<ids.length;)container.appendChild(snippets[ids[n]].content),n++},_applySortData:function(sortData){var id,sorted=[];for(id in sortData.snippets)sortData.snippets.hasOwnProperty(id)&&sorted.push({id:id,values:sortData.snippets[id]});return sorted.sort(Helpers._compareSnippets.bind(null,sortData.descriptor)),sorted.map(function(snippet){return snippet.id})},_compareSnippets:function(descriptor,a,b){var i,n,v;for(i=0,n=descriptor.length;i<n;i++)if(0!==(v=a.values[i]<b.values[i]?-1:a.values[i]>b.values[i]?1:0))return v*(descriptor[i].asc?1:-1);return 0},_getSortData:function(params,elem,changeset){var sortData=params.sortCache;if(sortData)for(var id in sortData.snippets)sortData.snippets.hasOwnProperty(id)&&(id in changeset.remove||!DOM.getById(id))&&delete sortData.snippets[id];else sortData=Helpers._buildSortData(params,elem,changeset),!1!==params.sortCache&&(params.sortCache=sortData);return sortData},_buildSortData:function(params,elem,changeset){var sortData={descriptor:params.sort.trim().split(/\s*,\s*/g).map(Helpers._parseDescriptor.bind(null,params.id)),snippets:{}},children={};return DOM.getChildren(elem).forEach(function(child){child.id in changeset.remove||child.id in changeset.update||(children[child.id]={content:child})}),Helpers._mergeSortData(sortData,children),sortData},_mergeSortData:function(sortData,snippets){for(var id in snippets)snippets.hasOwnProperty(id)&&(sortData.snippets[id]=Helpers._extractSortData(snippets[id].content,sortData.descriptor))},_extractSortData:function(elem,descriptor){return descriptor.map(function(field){return field.extractor(elem)})},_parseDescriptor:function(id,descriptor){var sel,attr,prop,asc,m=descriptor.match(/^(.+?)(?:\[(.+?)\])?(?:\((.+?)\))?(?:\s+(.+?))?$/);if(!m)throw new Error("Invalid sort descriptor: "+descriptor);if(sel=m[1],attr=m[2],prop=m[3],asc=m[4],sel.match(/^[^.]|[\s#\[>+:]/))throw new TypeError("Invalid selector for sorted insert mode in container #"+id);return sel=sel.substr(1),asc=!asc||/^[1tay]/i.test(asc),attr?{extractor:Helpers._getAttrExtractor(sel,attr),asc:asc}:prop?{extractor:Helpers._getDataExtractor(sel,prop),asc:asc}:{extractor:Helpers._getTextExtractor(sel),asc:asc}},_getAttrExtractor:function(sel,attr){return function(elem){return(elem=elem.getElementsByClassName(sel)).length&&elem[0].getAttribute(attr)||null}},_getDataExtractor:function(sel,prop){return function(elem){return(elem=elem.getElementsByClassName(sel)).length?DOM.getData(elem[0],prop,null):null}},_getTextExtractor:function(sel){return function(elem){return(elem=elem.getElementsByClassName(sel)).length?elem[0].textContent:null}}};_context.register(Helpers,"SnippetManagerHelpers")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(Helpers,Snippet,DOM,Arrays,undefined){var SnippetManager=_context.extend("Nittro.Object",function(){SnippetManager.Super.call(this),this._.snippets={},this._.containerCache=null,this._.currentPhase=Snippet.INACTIVE},{getSnippet:function(id){return this._.snippets[id]||(this._.snippets[id]=new Snippet(id,this._.currentPhase)),this._.snippets[id]},isSnippet:function(elem){return("string"==typeof elem?elem:elem.id)in this._.snippets},setup:function(){this.trigger("after-update"),this._runSnippetsPhase(this._.snippets,Snippet.PREPARE_SETUP),this._runSnippetsPhase(this._.snippets,Snippet.RUN_SETUP)},getRemoveTargets:function(elem){var sel=DOM.getData(elem,"dynamic-remove");return sel?DOM.find(sel):[]},computeChanges:function(snippets,removeTargets){this._clearDynamicContainerCache();var changeset={remove:{},update:{},add:{},containers:{}};return this._resolveRemovals(removeTargets,changeset),this._resolveUpdates(snippets,changeset),this._resolveDynamicSnippets(changeset),changeset},applyChanges:function(changeset){var teardown=Arrays.mergeTree({},changeset.remove,changeset.update);return this._runSnippetsPhase(teardown,Snippet.PREPARE_TEARDOWN),this._runSnippetsPhase(teardown,Snippet.RUN_TEARDOWN),this._runSnippetsPhase(teardown,Snippet.INACTIVE),this.trigger("before-update",changeset),this._applyRemove(changeset.remove),this._applyUpdate(changeset.update),this._applyAdd(changeset.add,changeset.containers),this._applyDynamic(changeset.containers,Arrays.mergeTree({},changeset.update,changeset.add)),this.trigger("after-update",changeset),this._runSnippetsPhaseOnNextFrame(this._.snippets,Snippet.PREPARE_SETUP).then(function(){this._runSnippetsPhase(this._.snippets,Snippet.RUN_SETUP)}.bind(this))},cleanupDescendants:function(elem,changeset){var id,snippet,snippets=changeset?changeset.remove:{};for(id in this._.snippets)!this._.snippets.hasOwnProperty(id)||id in snippets||(snippet=this._.snippets[id].getElement())!==elem&&DOM.contains(elem,snippet)&&(snippets[id]={element:snippet,isDescendant:!0});changeset||(this._runSnippetsPhase(snippets,Snippet.PREPARE_TEARDOWN),this._runSnippetsPhase(snippets,Snippet.RUN_TEARDOWN),this._runSnippetsPhase(snippets,Snippet.INACTIVE))},_resolveRemovals:function(removeTargets,changeset){removeTargets.forEach(function(elem){changeset.remove[elem.id]={element:elem},this.cleanupDescendants(elem,changeset)}.bind(this))},_resolveUpdates:function(snippets,changeset){var id,elem,params;for(id in snippets)snippets.hasOwnProperty(id)&&((elem=DOM.getById(id))?(this.cleanupDescendants(elem,changeset),id in changeset.remove&&(params=this._resolveAddition(id,snippets[id]))?changeset.add[id]=params:changeset.update[id]=this._resolveUpdate(elem,snippets[id])):(params=this._resolveAddition(id,snippets[id]))&&(changeset.add[id]=params))},_resolveDynamicSnippets:function(changeset){var id,type,cid,params;for(type in{update:1,add:1})for(id in changeset[type])changeset[type].hasOwnProperty(id)&&(cid=changeset[type][id].container)&&("prepend"!==(params=this._getDynamicContainerParams(cid)).sort&&"append"!==params.sort?(changeset.containers[cid]||(changeset.containers[cid]={}),changeset.containers[cid][id]=changeset[type][id]):changeset[type][id].action=params.sort);for(cid in changeset.containers)changeset.containers.hasOwnProperty(cid)&&(changeset.containers[cid]=Helpers.computeSortedSnippets(this.getSnippet(cid),changeset.containers[cid],changeset))},_resolveUpdate:function(elem,content){return{element:elem,content:Helpers.buildContent(elem.tagName,content),container:DOM.hasClass(elem.parentNode,"nittro-snippet-container")?elem.parentNode.id:null}},_resolveAddition:function(id,content){var elem,params=this._getDynamicContainerParamsForId(id);return params?((elem=Helpers.buildContent(params.element,content)).id=id,{content:elem,container:params.id}):null},_runSnippetsPhase:function(snippets,phase){for(var id in this._.currentPhase=phase,snippets)snippets.hasOwnProperty(id)&&this.getSnippet(id).runPhase(phase)},_runSnippetsPhaseOnNextFrame:function(snippets,phase){return new Promise(function(fulfill){window.requestAnimationFrame(function(){this._runSnippetsPhase(snippets,phase),fulfill()}.bind(this))}.bind(this))},_applyRemove:function(snippets){for(var id in snippets)snippets.hasOwnProperty(id)&&(!snippets[id].isDescendant&&snippets[id].element.parentNode&&snippets[id].element.parentNode.removeChild(snippets[id].element),id in this._.snippets&&delete this._.snippets[id])},_applyUpdate:function(snippets){for(var id in snippets)snippets.hasOwnProperty(id)&&(DOM.empty(snippets[id].element),DOM.append(snippets[id].element,Arrays.createFrom(snippets[id].content.childNodes)))},_applyAdd:function(snippets,containers){for(var id in snippets)!snippets.hasOwnProperty(id)||snippets[id].container in containers||("prepend"===snippets[id].action?DOM.prepend(snippets[id].container,snippets[id].content):DOM.append(snippets[id].container,snippets[id].content))},_applyDynamic:function(containers,snippets){for(var cid in containers)containers.hasOwnProperty(cid)&&Helpers.applySortedSnippets(this.getSnippet(cid).getElement(),containers[cid],snippets)},_getDynamicContainerCache:function(){return null===this._.containerCache&&(this._.containerCache=DOM.getByClassName("nittro-snippet-container").map(function(elem){return elem.id})),this._.containerCache},_clearDynamicContainerCache:function(){this._.containerCache=null},_getDynamicContainerParams:function(id){var container=this.getSnippet(id),params=container.isContainer()?container.getData("_snippet_container"):null;return params&&!1!==params.sortCache?params:Helpers.prepareDynamicContainer(container)},_getDynamicContainerParamsForId:function(id){var i,n,params,cache=this._getDynamicContainerCache();for(i=0,n=cache.length;i<n;i++)if((params=this._getDynamicContainerParams(cache[i])).mask.test(id))return params;return window.console&&console.error("Dynamic snippet #"+id+" has no container"),null}});_context.register(SnippetManager,"SnippetManager")},{Helpers:"Nittro.Page.SnippetManagerHelpers",DOM:"Utils.DOM",Arrays:"Utils.Arrays"}),_context.invoke("Nittro.Page",function(){var SnippetAgent=_context.extend(function(page,snippetManager){this._={page:page,snippetManager:snippetManager},this._.page.on("transaction-created",this._initTransaction.bind(this))},{_initTransaction:function(evt){var data={removeTargets:"remove"in evt.data.context?evt.data.context.remove||[]:evt.data.context.element?this._.snippetManager.getRemoveTargets(evt.data.context.element):[]};evt.data.transaction.on("ajax-response",this._handleResponse.bind(this,data))},_handleResponse:function(data,evt){var changeset,payload=evt.data.response.getPayload();(payload.snippets||data.removeTargets.length)&&(changeset=this._.snippetManager.computeChanges(payload.snippets||{},data.removeTargets),evt.waitFor(this._applyChangeset(evt.target,changeset)))},_applyChangeset:function(transaction,changeset){return Promise.resolve().then(this._doApplyChangeset.bind(this,transaction,changeset))},_doApplyChangeset:function(transaction,changeset){return transaction.trigger("snippets-apply",{changeset:changeset}).then(function(){this._.snippetManager.applyChanges(changeset)}.bind(this))}});_context.register(SnippetAgent,"SnippetAgent")}),_context.invoke("Nittro.Page",function(Arrays){var AjaxAgent=_context.extend(function(page,ajax,options){this._={page:page,ajax:ajax,options:Arrays.mergeTree({},AjaxAgent.defaults,options)},this._.page.on("before-transaction",this._checkTransaction.bind(this)),this._.page.on("transaction-created",this._initTransaction.bind(this))},{STATIC:{defaults:{whitelistRedirects:!1}},_checkTransaction:function(evt){this._.ajax.isAllowedOrigin(evt.data.url)&&this._.ajax.supports(evt.data.url,evt.data.context.method,evt.data.context.data)||evt.preventDefault()},_initTransaction:function(evt){var data={request:this._.ajax.createRequest(evt.data.transaction.getUrl(),evt.data.context.method,evt.data.context.data)};evt.data.transaction.on("dispatch",this._dispatch.bind(this,data)),evt.data.transaction.on("abort",this._abort.bind(this,data))},_dispatch:function(data,evt){evt.waitFor(Promise.resolve().then(this._doDispatch.bind(this,evt.target,data)))},_doDispatch:function(transaction,data){return transaction.trigger("ajax-request",{request:data.request}).then(this._.ajax.dispatch.bind(this._.ajax,data.request)).then(this._handleResponse.bind(this,transaction,data))},_abort:function(data){data.request.abort()},_handleResponse:function(transaction,data,response){return Promise.resolve().then(this._doHandleResponse.bind(this,transaction,data,response))},_doHandleResponse:function(transaction,data,response){return transaction.trigger("ajax-response",{response:response}).then(function(){var payload=response.getPayload();return payload.postGet&&transaction.setUrl(payload.url),"redirect"in payload?(this._.options.whitelistRedirects?payload.allowAjax:!1!==payload.allowAjax)&&this._.ajax.isAllowedOrigin(payload.redirect)?(transaction.setUrl(payload.redirect),data.request=this._.ajax.createRequest(payload.redirect),this._doDispatch(transaction,data)):(document.location.href=payload.redirect,new Promise(function(){})):data.request}.bind(this))}});_context.register(AjaxAgent,"AjaxAgent")},{Arrays:"Utils.Arrays"}),_context.invoke("Nittro.Page",function(Arrays,DOM,Url){var HistoryAgent=_context.extend(function(page,history,options){this._={page:page,history:history,options:Arrays.mergeTree({},HistoryAgent.defaults,options)},this._.page.on("transaction-created",this._initTransaction.bind(this))},{STATIC:{defaults:{whitelistHistory:!1}},_initTransaction:function(evt){evt.data.context.fromHistory?evt.data.transaction.setIsFromHistory():"history"in evt.data.context?evt.data.transaction.setIsHistoryState(evt.data.context.history):evt.data.context.element?evt.data.transaction.setIsHistoryState(DOM.getData(evt.data.context.element,"history",!this._.options.whitelistHistory)):evt.data.transaction.setIsHistoryState(!this._.options.whitelistHistory);var data={title:document.title};evt.data.transaction.on("dispatch",this._dispatch.bind(this,data)),evt.data.transaction.on("ajax-response",this._handleResponse.bind(this,data))},_dispatch:function(data,evt){evt.target.then(this._saveState.bind(this,evt.target,data),function(){})},_handleResponse:function(data,evt){var payload=evt.data.response.getPayload();payload.title&&(data.title=payload.title)},_saveState:function(transaction,data){transaction.getUrl().getOrigin()!==Url.fromCurrent().getOrigin()||transaction.isBackground()?transaction.setIsHistoryState(!1):transaction.isHistoryState()&&(data.state={},transaction.trigger("history-save",data).isDefaultPrevented()||this._.history.push(transaction.getUrl().toAbsolute(),data.title,data.state)),data.title&&(document.title=data.title)}});_context.register(HistoryAgent,"HistoryAgent")},{Arrays:"Utils.Arrays",DOM:"Utils.DOM",Url:"Utils.Url"}),_context.invoke("Nittro.Page",function(DOM,Arrays){var location=window.history.location||window.location,History=_context.extend("Nittro.Object",function(){History.Super.call(this),this._.state=null,DOM.addListener(window,"popstate",this._handleState.bind(this))},{init:function(){window.history.state&&window.history.state._nittro?this._.state=window.history.state.data:(this._.state={},this.update())},push:function(url,title,data){this._saveState(url,title,data,!1)},replace:function(url,title,data){this._saveState(url,title,data,!0)},update:function(data){Arrays.mergeTree(this._.state,data),window.history.replaceState({_nittro:!0,data:this._.state},document.title,location.href)},getState:function(){return this._.state},_saveState:function(url,title,data,replace){data=data||{},this.trigger("before-savestate",data),this._.state=data,replace?window.history.replaceState({_nittro:!0,data:data},title||document.title,url):window.history.pushState({_nittro:!0,data:data},title||document.title,url),title&&(document.title=title),this.trigger("savestate",{title:title,url:url,data:data,replace:replace})},_handleState:function(evt){evt.state&&evt.state._nittro&&(this._.state=evt.state.data,this.trigger("popstate",{title:document.title,url:location.href,data:evt.state.data}))}});_context.register(History,"History")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"}),_context.invoke("Nittro.Page",function(DOM,Arrays,CSSTransitions,undefined){var TransitionAgent=_context.extend("Nittro.Object",function(page,options){TransitionAgent.Super.call(this),this._.page=page,this._.options=Arrays.mergeTree({},TransitionAgent.defaults,options),this._.page.on("transaction-created",this._initTransaction.bind(this))},{STATIC:{defaults:{defaultSelector:".nittro-transition-auto"}},_initTransaction:function(evt){var data={elements:this._getTransitionTargets(evt.data.context),removeTargets:this._getRemoveTargets(evt.data.context)};evt.data.transaction.on("dispatch",this._dispatch.bind(this,data)),evt.data.transaction.on("abort",this._abort.bind(this,data)),evt.data.transaction.on("snippets-apply",this._handleSnippets.bind(this,data))},_dispatch:function(data,evt){evt.target.on("error",this._handleError.bind(this,data)),evt.target.then(this._transitionIn.bind(this,data,!1),this._transitionIn.bind(this,data,!0)),(data.elements.length||data.removeTargets.length)&&(DOM.addClass(data.removeTargets,"nittro-dynamic-remove"),data.transitionOut=this._transitionOut(data),evt.waitFor(data.transitionOut))},_abort:function(data){(data.elements.length||data.removeTargets.length)&&this._transitionIn(data,!0)},_handleSnippets:function(data,evt){var id,changeset=evt.data.changeset;for(id in changeset.add)changeset.add.hasOwnProperty(id)&&(DOM.addClass(changeset.add[id].content,"nittro-dynamic-add","nittro-transition-middle"),data.elements.push(changeset.add[id].content));data.transitionOut&&evt.waitFor(data.transitionOut)},_handleError:function(data,evt){data.transitionOut&&evt.waitFor(data.transitionOut)},_transitionOut:function(data){return this._transition(data.elements.concat(data.removeTargets),"out")},_transitionIn:function(data,aborting){var elements=aborting?data.elements.concat(data.removeTargets):data.elements;if(elements.length)return this._transition(elements,"in").then(function(){DOM.removeClass(elements,"nittro-dynamic-add","nittro-dynamic-remove")})},_transition:function(elements,dir){return CSSTransitions.run(elements,{add:"nittro-transition-active nittro-transition-"+dir,remove:"nittro-transition-middle",after:"out"===dir?"nittro-transition-middle":null},"in"===dir)},_getTransitionTargets:function(context){var sel,targets;return(sel=context.transition!==undefined?context.transition:context.element?DOM.getData(context.element,"transition"):undefined)!==undefined||context.element&&DOM.getData(context.element,"dynamic-remove")||(sel=this._.options.defaultSelector),targets=sel?DOM.find(sel):[],this.trigger("prepare-transition-targets",{element:context.element,targets:targets}),targets},_getRemoveTargets:function(context){if(!context.element)return[];var sel=DOM.getData(context.element,"dynamic-remove"),targets=sel?DOM.find(sel):[];return targets.length&&this.trigger("prepare-remove-targets",{targets:targets.slice()}),targets}});_context.register(TransitionAgent,"TransitionAgent")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",CSSTransitions:"Utils.CSSTransitions"}),_context.invoke("Nittro.Page",function(DOM,Arrays){var location=window.history.location||window.location,ScrollAgent=_context.extend(function(page,history,options){this._={page:page,history:history,anchor:DOM.create("div"),options:Arrays.mergeTree({},ScrollAgent.defaults,options)},this._.anchor.style.position="absolute",this._.anchor.style.left=0,this._.anchor.style.top=0,this._.anchor.style.width="100%",this._.anchor.style.height="1px",this._.anchor.style.marginTop="-1px",window.history.scrollRestoration="manual",this._.page.on("ready",this._init.bind(this)),this._.page.on("transaction-created",this._initTransaction.bind(this))},{STATIC:{defaults:{target:null,margin:30,scrollDown:!1,duration:400}},_init:function(){var target,state=this._.history.getState();"scrollAgent"in state?target=state.scrollAgent.target:location.hash.match(/^#[^\s\[>+:.]+$/i)&&(target=this._resolveSingleTarget(location.hash)),"number"==typeof target&&this._scrollTo(target,!0,!0)},_initTransaction:function(evt){if(!evt.data.transaction.isBackground()){var rect=document.body.getBoundingClientRect(),data={previous:window.pageYOffset,target:this._.options.target};this._.anchor.style.top=data.previous+rect.bottom+"px",document.body.appendChild(this._.anchor),evt.data.transaction.on("dispatch",this._dispatch.bind(this,data)),evt.data.transaction.on("abort error",this._cleanup.bind(this)),evt.data.transaction.on("ajax-response",this._handleResponse.bind(this,data)),evt.data.transaction.on("snippets-apply",this._handleSnippets.bind(this,data)),evt.data.transaction.on("history-save",this._handleHistory.bind(this,data)),"scrollTo"in evt.data.context?data.target=evt.data.context.scrollTo:evt.data.context.element&&evt.data.context.element.hasAttribute("data-scroll-to")&&(data.target=DOM.getData(evt.data.context.element,"scroll-to",null))}},_dispatch:function(data,evt){var state=this._.history.getState();null===data.target&&evt.target.isFromHistory()&&state&&"scrollAgent"in state&&(data.target=state.scrollAgent.target),evt.target.then(this._apply.bind(this,data,evt.target),this._cleanup.bind(this))},_cleanup:function(){this._.anchor.parentNode&&(this._.anchor.parentNode.removeChild(this._.anchor),this._.anchor.style.top=0)},_handleResponse:function(data,evt){var payload=evt.data.response.getPayload();"scrollTo"in payload&&(data.target=payload.scrollTo)},_handleSnippets:function(data,evt){if(null===data.target){var id,params;for(id in data.target=[],evt.data.changeset.add)evt.data.changeset.add.hasOwnProperty(id)&&(params=evt.data.changeset.add[id],DOM.getData(params.container,"scroll-ignore")||data.target.push("#"+id));for(id in evt.data.changeset.update)evt.data.changeset.update.hasOwnProperty(id)&&(DOM.getData(id,"scroll-ignore")||data.target.push("#"+id))}},_apply:function(data,transaction){this._resolveTarget(data)?this._scrollTo(data.target,transaction.isFromHistory()):this._cleanup()},_scrollTo:function(to,force,instant){var y0=window.pageYOffset,dy=to-y0,t0=Date.now(),dt=this._.options.duration,a=this._.anchor;force||this._.options.scrollDown||dy<0?instant?window.scrollTo(null,to):window.requestAnimationFrame(function step(){var y,x=(Date.now()-t0)/dt;x<=1?(window.requestAnimationFrame(step),y=y0+dy*(-.5*Math.cos(Math.PI*x)+.5),window.scrollTo(null,y)):a.parentNode&&(a.parentNode.removeChild(a),a.style.top=0)}):this._cleanup()},_handleHistory:function(data,evt){this._.history.update({scrollAgent:{target:data.previous}}),this._resolveTarget(data),evt.data.state.scrollAgent={target:data.target}},_resolveSingleTarget:function(target){return!1!==target&&(null===target?0:"string"==typeof target?(target=DOM.find(target)[0])?target.getBoundingClientRect().top+window.pageYOffset-this._.options.margin:0:"number"==typeof target&&target)},_resolveTarget:function(data){return!1!==data.target&&(null===data.target?data.target=0:"number"!=typeof data.target&&(Array.isArray(data.target)&&(data.target=data.target.join(",")),data.target=DOM.find(data.target).map(function(elem){return elem.getBoundingClientRect().top}),data.target=data.target.length?Math.min.apply(null,data.target)+window.pageYOffset-this._.options.margin:0),!0)}});_context.register(ScrollAgent,"ScrollAgent")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"}),_context.invoke("Nittro.Page",function(Url){var Transaction=_context.extend("Nittro.Object",function(url){Transaction.Super.call(this),this._.url=Url.from(url),this._.history=!0,this._.fromHistory=!1,this._.background=!1,this._.promise=new Promise(function(fulfill,reject){this._.fulfill=fulfill,this._.reject=reject}.bind(this))},{STATIC:{createRejected:function(url,reason){var self=new Transaction(url);return self._.reject(reason),self}},getUrl:function(){return this._.url},setUrl:function(url){return this._.url=Url.from(url),this},isHistoryState:function(){return this._.history},setIsHistoryState:function(value){return this._.history=value,this},isFromHistory:function(){return this._.fromHistory},setIsFromHistory:function(){this._.fromHistory=!0,this._.history=!1},isBackground:function(){return this._.background},setIsBackground:function(value){return this._.background=value,this},dispatch:function(){return this.trigger("dispatch").then(this._.fulfill,this._handleError.bind(this)),this},abort:function(){return this._.reject({type:"abort"}),this.trigger("abort"),this},then:function(onfulfilled,onrejected){return this._.promise.then(onfulfilled,onrejected)},_handleError:function(err){this.trigger("error").then(function(){this._.reject(err)}.bind(this))}});_context.register(Transaction,"Transaction")},{Url:"Utils.Url"}),_context.invoke("Nittro.Page",function(){var CspAgent=_context.extend(function(page,nonce){this._={page:page,nonce:nonce},this._.page.on("transaction-created",this._initTransaction.bind(this))},{_initTransaction:function(evt){var data={nonce:null,pending:null};evt.data.transaction.on("ajax-response",this._handleResponse.bind(this,data)),evt.data.transaction.on("snippets-apply",this._handleSnippets.bind(this,data))},_handleResponse:function(data,evt){if(!("redirect"in evt.data.response.getPayload())){var h=evt.data.response.getHeader("Content-Security-Policy")||evt.data.response.getHeader("Content-Security-Policy-Report-Only")||"",m=/(?:^|;\s*)script-src\s[^;]*'nonce-([^']+)'/.exec(h);data.nonce=!!m&&m[1]}},_handleSnippets:function(data,evt){this._handleChangeset(evt.data.changeset,data.nonce)},_handleChangeset:function(changeset,nonce){if(nonce){var id;for(id in changeset.add)changeset.add.hasOwnProperty(id)&&this._fixNonce(changeset.add[id].content,nonce);for(id in changeset.update)changeset.update.hasOwnProperty(id)&&this._fixNonce(changeset.update[id].content,nonce)}},_fixNonce:function(elem,nonce){var i,scripts=elem.getElementsByTagName("script");for(i=0;i<scripts.length;i++)scripts.item(i).nonce===nonce&&scripts.item(i).setAttribute("nonce",this._.nonce||"")}});_context.register(CspAgent,"CspAgent")}),_context.invoke("Nittro.Page",function(Url){var GoogleAnalyticsHelper=_context.extend(function(history){this._={history:history},this._.history.on("savestate popstate",this._handleState.bind(this))},{_handleState:function(evt){"function"!=typeof window.ga||evt.data.replace||(window.ga("set",{page:Url.from(evt.data.url).setHash(null).toLocal(),title:evt.data.title}),window.ga("send","pageview"))}});_context.register(GoogleAnalyticsHelper,"GoogleAnalyticsHelper")},{Url:"Utils.Url"}),_context.invoke("Nittro.Page",function(Transaction,DOM,Arrays,Url){var Service=_context.extend("Nittro.Object",function(snippetManager,history,options){Service.Super.call(this),this._.snippetManager=snippetManager,this._.history=history,this._.options=Arrays.mergeTree({},Service.defaults,options),this._.setup=!1,this._.currentTransaction=null,this._.currentUrl=Url.fromCurrent(),this._.history.on("popstate",this._handleState.bind(this)),DOM.addListener(document,"click",this._handleLinkClick.bind(this)),this._checkReady()},{STATIC:{defaults:{whitelistLinks:!1,backgroundErrors:!1}},open:function(url,method,data,context){try{context||(context={}),context.method=method,context.data=data;var evt=this.trigger("before-transaction",{url:url,context:context});return evt.isDefaultPrevented()?this._createRejectedTransaction(url,{type:"abort"}):(context.event&&context.event.preventDefault(),evt.then(function(){return evt.isDefaultPrevented()?this._createRejectedTransaction(url,{type:"abort"}):this._createTransaction(url,context)}.bind(this)))}catch(e){return this._createRejectedTransaction(url,e)}},openLink:function(link,evt){return this.open(link.href,"get",null,{event:evt,element:link})},getSnippet:function(id){return this._.snippetManager.getSnippet(id)},isSnippet:function(elem){return this._.snippetManager.isSnippet(elem)},_handleState:function(evt){if(this._checkUrl(null,this._.currentUrl)){var url=Url.from(evt.data.url);this._.currentUrl=url,this.open(url,"get",null,{fromHistory:!0}).then(null,function(){document.location.href=url.toAbsolute()})}},_checkReady:function(){"loading"!==document.readyState?this._.setup||(this._.setup=!0,Promise.resolve().then(function(){this._.history.init(),this._.snippetManager.setup(),this.trigger("ready")}.bind(this))):DOM.addListener(document,"readystatechange",this._checkReady.bind(this))},_handleLinkClick:function(evt){if(!(evt.defaultPrevented||evt.ctrlKey||evt.shiftKey||evt.altKey||evt.metaKey||0<evt.button)){var link=DOM.closest(evt.target,"a");link&&this._checkLink(link)&&this._checkUrl(link.href)&&this.openLink(link,evt)}},_createTransaction:function(url,context){var transaction=new Transaction(url);return this._initTransaction(transaction,context),this.trigger("transaction-created",{transaction:transaction,context:context}),this._dispatchTransaction(transaction)},_createRejectedTransaction:function(url,reason){var transaction=Transaction.createRejected(url,reason);return transaction.then(null,this._handleError.bind(this,transaction))},_initTransaction:function(transaction,context){"background"in context?transaction.setIsBackground(context.background):context.element&&transaction.setIsBackground(DOM.getData(context.element,"background",!1))},_dispatchTransaction:function(transaction){return transaction.isBackground()||(this._.currentTransaction&&this._.currentTransaction.abort(),this._.currentTransaction=transaction),transaction.dispatch().then(this._handleSuccess.bind(this,transaction),this._handleError.bind(this,transaction))},_checkUrl:function(url,current){return url=url?Url.from(url):Url.fromCurrent(),current=current?Url.from(current):Url.fromCurrent(),url.compare(current)!==Url.PART.HASH},_checkLink:function(link){return!link.hasAttribute("target")&&link.hasAttribute("href")&&DOM.getData(link,"ajax",!this._.options.whitelistLinks)},_handleSuccess:function(transaction){transaction.isBackground()||(this._.currentTransaction=null),transaction.isHistoryState()&&(this._.currentUrl=transaction.getUrl())},_handleError:function(transaction,err){transaction===this._.currentTransaction&&(this._.currentTransaction=null),transaction.isBackground()&&!this._.options.backgroundErrors||this.trigger("error",err)}});_context.register(Service,"Service")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",Url:"Utils.Url"}),_context.invoke("Nittro.Flashes",function(DOM){var Helpers={hasFixedParent:function(elem){do{if("fixed"===DOM.getStyle(elem,"position",!1))return!0;elem=elem.offsetParent}while(elem&&elem!==document.documentElement&&elem!==document.body);return!1},getRect:function(elem){var rect=elem.getBoundingClientRect();return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:"width"in rect?rect.width:rect.right-rect.left,height:"height"in rect?rect.height:rect.bottom-rect.top}},tryFloatingPosition:function(elem,target,placement,positioner){DOM.addClass(elem,"nittro-flash-floating"),DOM.setStyle(elem,{position:"absolute",opacity:0});var position,fixed=Helpers.hasFixedParent(target),elemRect=Helpers.getRect(elem),targetRect=Helpers.getRect(target),style={},order=positioner.getDefaultOrder(),force=!1;if(fixed&&(style.position="fixed"),placement){var m=placement.match(/^(.+?)(!)?(!)?$/);if(!positioner.supports(m[1]))throw new Error("Placement '"+m[1]+"' isn't supported");force=!!m[3],order=m[2]?[m[1]]:[m[1]].concat(order)}for(var i=0;i<order.length&&!(position=positioner[placement=order[i]].call(positioner,targetRect,elemRect,force));i++);return position?(style.left=position.left,style.top=position.top,fixed||(style.left+=window.pageXOffset,style.top+=window.pageYOffset),style.left+="px",style.top+="px",style.opacity="",DOM.setStyle(elem,style),placement):(DOM.removeClass(elem,"nittro-flash-floating"),DOM.setStyle(elem,{position:"",opacity:""}),null)}};_context.register(Helpers,"Helpers")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Flashes",function(DOM,Arrays,CSSTransitions,Helpers){var Message=_context.extend("Nittro.Object",function(service,content,options){if(Message.Super.call(this),this._doDismiss=this._doDismiss.bind(this),this._.service=service,this._.options=Arrays.mergeTree({},Message.defaults,options),this._.visible=!1,null===this._.service)return this._.elem=content,this._.visible=!0,this._normalizeDismissTime(),void this._scheduleDismiss();var target=this._getTarget(),tag="div";target?(null===this._.options.classes&&(this._.options.classes=DOM.getData(target,"flash-classes")),null===this._.options.inline&&(this._.options.inline=DOM.getData(target,"flash-inline")),null===this._.options.rich&&(this._.options.rich=DOM.getData(target,"flash-rich")),this._.options.inline&&(tag=target.tagName.match(/^(?:ul|ol)$/i)?"li":"p")):this._.options.inline=!1,this._.elem=DOM.create(tag,{class:"nittro-flash nittro-flash-"+this._.options.type,"data-flash-dynamic":"true"}),this._.options.classes&&DOM.addClass(this._.elem,this._.options.classes.replace(/%type%/g,this._.options.type)),this._.options.rich?DOM.html(this._.elem,content):(DOM.addClass(this._.elem,"nittro-flash-plain"),this._.elem.textContent=content),this._normalizeDismissTime()},{STATIC:{wrap:function(elem){return new Message(null,elem)},defaults:{type:"info",target:null,classes:null,inline:null,placement:null,rich:null,dismiss:null}},getElement:function(){return this._.elem},show:function(){if(!1!==this._.visible)return Promise.resolve(this);this._.visible=null;var target=this._getTarget();if(target){if(this._.options.inline)return target.appendChild(this._.elem),this._show("inline");this._.service.getLayer().appendChild(this._.elem);var placement=Helpers.tryFloatingPosition(this._.elem,target,this._.options.placement,this._.service.getPositioner());if(placement)return this._show(placement)}return this._.service.getGlobalHolder().appendChild(this._.elem),this._show("global")},hide:function(){return!0!==this._.visible?Promise.resolve(this):(this._.visible=null,DOM.addClass(this._.elem,"nittro-flash-hide"),this.trigger("hide"),CSSTransitions.run(this._.elem).then(function(){return this._.visible=!1,this._.elem.parentNode.removeChild(this._.elem),DOM.removeClass(this._.elem,"nittro-flash-hide"),this.trigger("hidden"),this}.bind(this)))},dismiss:function(){return this.hide().then(function(){this.off(),this._.elem=this._.options=this._.service=null}.bind(this))},_show:function(placement){return DOM.toggleClass(this._.elem,"nittro-flash-prepare nittro-flash-"+placement,!0),this.trigger("show"),this.one("hidden",function(){DOM.toggleClass(this._.elem,"nittro-flash-"+placement,!1)}),CSSTransitions.run(this._.elem,{remove:"nittro-flash-prepare"},!0).then(function(){return this._.visible=!0,this.trigger("shown"),this._scheduleDismiss(),this}.bind(this))},_normalizeDismissTime:function(){!1!==this._.options.dismiss&&"number"!=typeof this._.options.dismiss&&(this._.options.dismiss=Math.max(5e3,Math.round(this._.elem.textContent.split(/\s+/).length/.003)))},_scheduleDismiss:function(){!1!==this._.options.dismiss&&(DOM.addListener(document,"mousemove",this._doDismiss),DOM.addListener(document,"mousedown",this._doDismiss),DOM.addListener(document,"keydown",this._doDismiss),DOM.addListener(document,"touchstart",this._doDismiss))},_doDismiss:function(){DOM.removeListener(document,"mousemove",this._doDismiss),DOM.removeListener(document,"mousedown",this._doDismiss),DOM.removeListener(document,"keydown",this._doDismiss),DOM.removeListener(document,"touchstart",this._doDismiss),window.setTimeout(this.dismiss.bind(this),this._.options.dismiss)},_getTarget:function(){return"string"==typeof this._.options.target?DOM.getById(this._.options.target):this._.options.target}});_context.register(Message,"Message")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",CSSTransitions:"Utils.CSSTransitions"}),_context.invoke("Nittro.Flashes",function(){var DefaultPositioner=_context.extend(function(margin,defaultOrder){this._={margin:"number"==typeof margin?margin:20,defaultOrder:defaultOrder||"above,rightOf,below,leftOf"},"string"==typeof this._.defaultOrder&&(this._.defaultOrder=this._.defaultOrder.split(/\s*,\s*/g))},{supports:function(placement){return"above"===placement||"below"===placement||"leftOf"===placement||"rightOf"===placement},getDefaultOrder:function(){return this._.defaultOrder},above:function(target,elem,force){var res={left:target.left+(target.width-elem.width)/2,top:target.top-elem.height};if(force||res.left>this._.margin&&res.left+elem.width<window.innerWidth-this._.margin&&res.top>this._.margin&&res.top+elem.height<window.innerHeight-this._.margin)return res},below:function(target,elem,force){var res={left:target.left+(target.width-elem.width)/2,top:target.bottom};if(force||res.left>this._.margin&&res.left+elem.width<window.innerWidth-this._.margin&&res.top+elem.height<window.innerHeight-this._.margin&&res.top>this._.margin)return res},leftOf:function(target,elem,force){var res={left:target.left-elem.width,top:target.top+(target.height-elem.height)/2};if(force||res.top>this._.margin&&res.top+elem.height<window.innerHeight-this._.margin&&res.left>this._.margin&&res.left+elem.width<window.innerWidth-this._.margin)return res},rightOf:function(target,elem,force){var res={left:target.right,top:target.top+(target.height-elem.height)/2};if(force||res.top>this._.margin&&res.top+elem.height<window.innerHeight-this._.margin&&res.left+elem.width<window.innerWidth-this._.margin&&res.left>this._.margin)return res}});_context.register(DefaultPositioner,"DefaultPositioner")}),_context.invoke("Nittro.Flashes",function(Message,DOM,Arrays){var Service=_context.extend(function(positioner,options){this._={positioner:positioner,options:Arrays.mergeTree({},Service.defaults,options),globalHolder:DOM.create("div",{class:"nittro-flash-global-holder"})},"string"==typeof this._.options.layer?this._.options.layer=DOM.getById(this._.options.layer):this._.options.layer||(this._.options.layer=document.body),this._.options.layer.appendChild(this._.globalHolder),this._.options.classes||(this._.options.classes=DOM.getData(this._.options.layer,"flash-classes")),Message.defaults.classes=this._.options.classes,this._removeStatic()},{STATIC:{defaults:{layer:null,classes:null}},create:function(content,options){return new Message(this,content,options)},add:function(content,type,target,rich){var options;return options=type&&"object"==typeof type?type:{type:type||"info",target:target,rich:rich},this.create(content,options).show()},getGlobalHolder:function(){return this._.globalHolder},getLayer:function(){return this._.options.layer},getPositioner:function(){return this._.positioner},_removeStatic:function(){DOM.getByClassName("nittro-flash").forEach(function(elem){DOM.getData(elem,"flash-dynamic")||Message.wrap(elem)}.bind(this))}});_context.register(Service,"Service")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",CSSTransitions:"Utils.CSSTransitions"}),_context.invoke("Nittro.Ajax.Bridges.AjaxDI",function(Nittro){var AjaxExtension=_context.extend("Nittro.DI.BuilderExtension",function(containerBuilder,config){AjaxExtension.Super.call(this,containerBuilder,config)},{STATIC:{defaults:{allowOrigins:null}},load:function(){var builder=this._getContainerBuilder(),config=this._getConfig(AjaxExtension.defaults);builder.addServiceDefinition("ajax",{factory:"Nittro.Ajax.Service()",args:{options:config},run:!0,setup:["::setTransport(Nittro.Ajax.Transport.Native())"]})}});_context.register(AjaxExtension,"AjaxExtension")}),_context.invoke("Nittro.Forms.Bridges.FormsDI",function(Nittro){var FormsExtension=_context.extend("Nittro.DI.BuilderExtension",function(containerBuilder,config){FormsExtension.Super.call(this,containerBuilder,config)},{STATIC:{defaults:{whitelistForms:!1,autoResetForms:!0}},load:function(){this._getContainerBuilder().addServiceDefinition("formLocator","Nittro.Forms.Locator()")},setup:function(){var builder=this._getContainerBuilder(),config=this._getConfig(FormsExtension.defaults);builder.hasServiceDefinition("page")&&builder.getServiceDefinition("page").addSetup(function(formLocator){this.initForms(formLocator,config)}),builder.hasServiceDefinition("formErrorRenderer")||builder.addServiceDefinition("formErrorRenderer","Nittro.Forms.DefaultErrorRenderer()")}});_context.register(FormsExtension,"FormsExtension")}),_context.invoke("Nittro.Forms.Bridges.FormsPage",function(Service,DOM){var FormsMixin={initForms:function(formLocator,options){this._.formLocator=formLocator,this._.options.whitelistForms=options.whitelistForms,this._.options.autoResetForms=options.autoResetForms,DOM.addListener(document,"submit",this._handleSubmit.bind(this)),DOM.addListener(document,"click",this._handleButtonClick.bind(this)),this._.snippetManager.on("after-update",this._refreshForms.bind(this)),this.on("transaction-created",this._initFormTransaction.bind(this))},sendForm:function(form,evt){var frm=this._.formLocator.getForm(form);return this.open(form.action,form.method,frm.serialize(),{event:evt,element:form}).then(this._handleFormSuccess.bind(this,frm))},_initFormTransaction:function(evt){if(evt.data.context.element&&evt.data.context.element instanceof HTMLFormElement){var data={form:this._.formLocator.getForm(evt.data.context.element),allowReset:!0};evt.data.transaction.on("ajax-response",this._handleFormResponse.bind(this,data)),evt.data.transaction.then(this._handleFormSuccess.bind(this,data),function(){})}},_handleFormResponse:function(data,evt){var payload=evt.data.response.getPayload();"allowReset"in payload&&(data.allowReset=payload.allowReset)},_handleFormSuccess:function(data){data.allowReset&&data.form.getElement()&&DOM.getData(data.form.getElement(),"reset",this._.options.autoResetForms)&&data.form.reset()},_handleSubmit:function(evt){!evt.defaultPrevented&&evt.target instanceof HTMLFormElement&&this._checkForm(evt.target)&&this.sendForm(evt.target,evt)},_handleButtonClick:function(evt){if(!(evt.defaultPrevented||evt.ctrlKey||evt.shiftKey||evt.altKey||evt.metaKey||0<evt.button)){var btn=DOM.closest(evt.target,"button")||DOM.closest(evt.target,"input");btn&&"submit"===btn.type&&btn.form&&this._checkForm(btn.form)&&this._.formLocator.getForm(btn.form).setSubmittedBy(btn.name||null)}},_checkForm:function(form){return!form.getAttribute("target")&&DOM.getData(form,"ajax",!this._.options.whitelistForms)},_refreshForms:function(){this._.formLocator.refreshForms()}};_context.register(FormsMixin,"FormsMixin"),_context.mixin(Service,FormsMixin),Service.defaults.whitelistForms=!1,Service.defaults.autoResetForms=!0},{Service:"Nittro.Page.Service",DOM:"Utils.DOM"}),_context.invoke("Nittro.Page.Bridges.PageDI",function(Nittro){var PageExtension=_context.extend("Nittro.DI.BuilderExtension",function(containerBuilder,config){PageExtension.Super.call(this,containerBuilder,config)},{STATIC:{defaults:{whitelistHistory:!1,whitelistLinks:!1,whitelistRedirects:!1,backgroundErrors:!1,csp:null,transitions:{defaultSelector:".nittro-transition-auto"},i18n:{connectionError:"There was an error connecting to the server. Please check your internet connection and try again.",unknownError:"There was an error processing your request. Please try again later."},scroll:{target:null,margin:30,scrollDown:!1,duration:500}}},load:function(){var builder=this._getContainerBuilder(),config=this._getConfig(PageExtension.defaults);if(builder.addServiceDefinition("page",{factory:"Nittro.Page.Service()",args:{options:{whitelistLinks:config.whitelistLinks,backgroundErrors:config.backgroundErrors}},run:!0}),builder.addServiceDefinition("ajaxAgent",{factory:"Nittro.Page.AjaxAgent()",args:{options:{whitelistRedirects:config.whitelistRedirects}},run:!0}),builder.addServiceDefinition("historyAgent",{factory:"Nittro.Page.HistoryAgent()",args:{options:{whitelistHistory:config.whitelistHistory}},run:!0}),builder.addServiceDefinition("scrollAgent",{factory:"Nittro.Page.ScrollAgent()",args:{options:config.scroll},run:!0}),builder.addServiceDefinition("snippetAgent","Nittro.Page.SnippetAgent()!"),builder.addServiceDefinition("snippetManager","Nittro.Page.SnippetManager()"),builder.addServiceDefinition("history","Nittro.Page.History()"),"function"==typeof window.ga&&builder.addServiceDefinition("googleAnalyticsHelper","Nittro.Page.GoogleAnalyticsHelper()!"),config.transitions&&builder.addServiceDefinition("transitionAgent",{factory:"Nittro.Page.TransitionAgent()",args:{options:{defaultSelector:config.transitions.defaultSelector}},run:!0}),!1!==config.csp){var i,n,scripts=document.getElementsByTagName("script"),nonce=null;for(i=0,n=scripts.length;i<n;i++)if(/^((text|application)\/javascript)?$/i.test(scripts.item(i).type)&&scripts.item(i).nonce){nonce=scripts.item(i).nonce;break}(config.csp||nonce)&&builder.addServiceDefinition("cspAgent",{factory:"Nittro.Page.CspAgent()",args:{nonce:nonce},run:!0})}},setup:function(){var builder=this._getContainerBuilder(),config=this._getConfig();builder.hasServiceDefinition("flashes")&&(builder.addServiceDefinition("flashAgent","Nittro.Page.Bridges.PageFlashes.FlashAgent()!"),builder.getServiceDefinition("page").addSetup(function(flashes){this.on("error:default",function(evt){"connection"===evt.data.type?flashes.add(config.i18n.connectionError,"error"):"abort"!==evt.data.type&&flashes.add(config.i18n.unknownError,"error")})}))}});_context.register(PageExtension,"PageExtension")}),_context.invoke("Nittro.Page.Bridges.PageFlashes",function(){var FlashAgent=_context.extend(function(page,flashes){this._={page:page,flashes:flashes},this._handleResponse=this._handleResponse.bind(this),this._.page.on("transaction-created",this._initTransaction.bind(this))},{_initTransaction:function(evt){evt.data.transaction.on("ajax-response",this._handleResponse)},_handleResponse:function(evt){var payload=evt.data.response.getPayload();!payload.redirect&&payload.flashes&&this._showFlashes(payload.flashes)},_showFlashes:function(flashes){var id,i;for(id in flashes)if(flashes.hasOwnProperty(id)&&flashes[id])for(i=0;i<flashes[id].length;i++)this._.flashes.add(flashes[id][i].message,flashes[id][i].type,id+"es")}});_context.register(FlashAgent,"FlashAgent")}),_context.invoke("Nittro.Flashes.Bridges.FlashesDI",function(Neon,NeonEntity,HashMap){var FlashesExtension=_context.extend("Nittro.DI.BuilderExtension",function(containerBuilder,config){FlashesExtension.Super.call(this,containerBuilder,config)},{STATIC:{defaults:{layer:null,classes:null,positioner:{defaultOrder:null,margin:null}}},load:function(){var positioner,builder=this._getContainerBuilder(),config=this._getConfig(FlashesExtension.defaults);positioner="string"==typeof config.positioner?config.positioner.match(/^@[^(]+$/)?config.positioner:Neon.decode("["+config.positioner+"]").shift():new NeonEntity("Nittro.Flashes.DefaultPositioner",HashMap.from(config.positioner)),builder.addServiceDefinition("flashes",{factory:"Nittro.Flashes.Service()",args:{positioner:positioner,options:{layer:config.layer,classes:config.classes}},run:!0})}});_context.register(FlashesExtension,"FlashesExtension")},{Neon:"Nittro.Neon.Neon",NeonEntity:"Nittro.Neon.NeonEntity",HashMap:"Utils.HashMap"}),_context.invoke("App",function(Nette){var NetteBasicFormToggle=_context.extend(function(snippetManager){this._={snippetManager:snippetManager},this._.snippetManager.on("after-update",this._handleUpdate.bind(this))},{_handleUpdate:function(){[].slice.call(document.getElementsByTagName("form")).forEach(Nette.toggleForm)}});_context.register(NetteBasicFormToggle,"NetteBasicFormToggle")},{Nette:"Nittro.Forms.Vendor"}),_context.invoke(function(Nittro){var builder=new Nittro.DI.ContainerBuilder({params:{},extensions:{ajax:"Nittro.Ajax.Bridges.AjaxDI.AjaxExtension()",forms:"Nittro.Forms.Bridges.FormsDI.FormsExtension()",page:"Nittro.Page.Bridges.PageDI.PageExtension()",flashes:"Nittro.Flashes.Bridges.FlashesDI.FlashesExtension()"},services:{netteBasicFormToggle:"App.NetteBasicFormToggle()!"},factories:{}});this.di=builder.createContainer(),this.di.runServices()}),window._stack||(window._stack=[]),function(stack){function exec(f){if("function"==typeof f)_context.invoke(f);else if("object"==typeof f&&void 0!==f.load){var q=_context.load.apply(_context,f.load);"function"==typeof f.then?q.then(f.then):f.then&&f.then instanceof Array&&q.then.apply(_context,f.then)}else _context.invoke.apply(_context,f)}for(;stack.length;)exec(stack.shift());stack.push=function(){for(var i=0;i<arguments.length;i++)exec(arguments[i])}}(window._stack);